{"ast":null,"code":"import * as i0 from '@angular/core';\nimport { NgModule, isDevMode, Injectable } from '@angular/core';\nimport { EMPTY } from 'rxjs';\nimport { filter, map } from 'rxjs/operators';\nimport * as i1 from '@spartacus/tracking/personalization/root';\nimport * as i2 from '@spartacus/core';\nclass PersonalizationCoreModule {}\nPersonalizationCoreModule.ɵfac = function PersonalizationCoreModule_Factory(t) {\n  return new (t || PersonalizationCoreModule)();\n};\nPersonalizationCoreModule.ɵmod = /* @__PURE__ */i0.ɵɵdefineNgModule({\n  type: PersonalizationCoreModule\n});\nPersonalizationCoreModule.ɵinj = /* @__PURE__ */i0.ɵɵdefineInjector({});\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(PersonalizationCoreModule, [{\n    type: NgModule,\n    args: [{}]\n  }], null, null);\n})();\nclass PersonalizationContextService {\n  constructor(config, cmsService) {\n    this.config = config;\n    this.cmsService = cmsService;\n  }\n  getPersonalizationContext() {\n    var _a;\n    if (!((_a = this.config.personalization) === null || _a === void 0 ? void 0 : _a.context)) {\n      if (isDevMode()) {\n        console.warn(`There is no context configured in Personalization.`);\n      }\n      return EMPTY;\n    } else {\n      const context = this.config.personalization.context;\n      return this.cmsService.getCurrentPage().pipe(filter(Boolean), map(page => {\n        var _a;\n        return (_a = page.slots) === null || _a === void 0 ? void 0 : _a[context.slotPosition];\n      }), filter(Boolean), map(slot => {\n        var _a, _b, _c;\n        const scriptComponent = (_a = slot.components) === null || _a === void 0 ? void 0 : _a.find(i => i.uid === context.componentId);\n        return this.buildPersonalizationContext((_c = (_b = scriptComponent === null || scriptComponent === void 0 ? void 0 : scriptComponent.properties) === null || _b === void 0 ? void 0 : _b.script) === null || _c === void 0 ? void 0 : _c.data);\n      }));\n    }\n  }\n  buildPersonalizationContext(data) {\n    if (data) {\n      const context = JSON.parse(atob(data));\n      context.actions.forEach(action => {\n        Object.keys(action).forEach(key => {\n          action[key] = atob(action[key]);\n        });\n      });\n      for (let i = 0; i < context.segments.length; i++) {\n        context.segments[i] = atob(context.segments[i]);\n      }\n      return context;\n    }\n  }\n}\nPersonalizationContextService.ɵfac = function PersonalizationContextService_Factory(t) {\n  return new (t || PersonalizationContextService)(i0.ɵɵinject(i1.PersonalizationConfig), i0.ɵɵinject(i2.CmsService));\n};\nPersonalizationContextService.ɵprov = /* @__PURE__ */i0.ɵɵdefineInjectable({\n  token: PersonalizationContextService,\n  factory: PersonalizationContextService.ɵfac,\n  providedIn: 'root'\n});\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(PersonalizationContextService, [{\n    type: Injectable,\n    args: [{\n      providedIn: 'root'\n    }]\n  }], function () {\n    return [{\n      type: i1.PersonalizationConfig\n    }, {\n      type: i2.CmsService\n    }];\n  }, null);\n})();\n\n/**\n * Generated bundle index. Do not edit.\n */\n\nexport { PersonalizationContextService, PersonalizationCoreModule };\n//# sourceMappingURL=spartacus-tracking-personalization-core.js.map","map":{"version":3,"names":["i0","NgModule","isDevMode","Injectable","EMPTY","filter","map","i1","i2","PersonalizationCoreModule","ɵfac","PersonalizationCoreModule_Factory","t","ɵmod","ɵɵdefineNgModule","type","ɵinj","ɵɵdefineInjector","ngDevMode","ɵsetClassMetadata","args","PersonalizationContextService","constructor","config","cmsService","getPersonalizationContext","_a","personalization","context","console","warn","getCurrentPage","pipe","Boolean","page","slots","slotPosition","slot","_b","_c","scriptComponent","components","find","i","uid","componentId","buildPersonalizationContext","properties","script","data","JSON","parse","atob","actions","forEach","action","Object","keys","key","segments","length","PersonalizationContextService_Factory","ɵɵinject","PersonalizationConfig","CmsService","ɵprov","ɵɵdefineInjectable","token","factory","providedIn"],"sources":["D:/demo_spartacus/node_modules/@spartacus/tracking/fesm2015/spartacus-tracking-personalization-core.js"],"sourcesContent":["import * as i0 from '@angular/core';\nimport { NgModule, isDevMode, Injectable } from '@angular/core';\nimport { EMPTY } from 'rxjs';\nimport { filter, map } from 'rxjs/operators';\nimport * as i1 from '@spartacus/tracking/personalization/root';\nimport * as i2 from '@spartacus/core';\n\nclass PersonalizationCoreModule {\n}\nPersonalizationCoreModule.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: \"12.0.0\", version: \"12.0.5\", ngImport: i0, type: PersonalizationCoreModule, deps: [], target: i0.ɵɵFactoryTarget.NgModule });\nPersonalizationCoreModule.ɵmod = i0.ɵɵngDeclareNgModule({ minVersion: \"12.0.0\", version: \"12.0.5\", ngImport: i0, type: PersonalizationCoreModule });\nPersonalizationCoreModule.ɵinj = i0.ɵɵngDeclareInjector({ minVersion: \"12.0.0\", version: \"12.0.5\", ngImport: i0, type: PersonalizationCoreModule });\ni0.ɵɵngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"12.0.5\", ngImport: i0, type: PersonalizationCoreModule, decorators: [{\n            type: NgModule,\n            args: [{}]\n        }] });\n\nclass PersonalizationContextService {\n    constructor(config, cmsService) {\n        this.config = config;\n        this.cmsService = cmsService;\n    }\n    getPersonalizationContext() {\n        var _a;\n        if (!((_a = this.config.personalization) === null || _a === void 0 ? void 0 : _a.context)) {\n            if (isDevMode()) {\n                console.warn(`There is no context configured in Personalization.`);\n            }\n            return EMPTY;\n        }\n        else {\n            const context = this.config.personalization.context;\n            return this.cmsService.getCurrentPage().pipe(filter(Boolean), map((page) => { var _a; return (_a = page.slots) === null || _a === void 0 ? void 0 : _a[context.slotPosition]; }), filter(Boolean), map((slot) => {\n                var _a, _b, _c;\n                const scriptComponent = (_a = slot.components) === null || _a === void 0 ? void 0 : _a.find((i) => i.uid === context.componentId);\n                return this.buildPersonalizationContext((_c = (_b = scriptComponent === null || scriptComponent === void 0 ? void 0 : scriptComponent.properties) === null || _b === void 0 ? void 0 : _b.script) === null || _c === void 0 ? void 0 : _c.data);\n            }));\n        }\n    }\n    buildPersonalizationContext(data) {\n        if (data) {\n            const context = JSON.parse(atob(data));\n            context.actions.forEach((action) => {\n                Object.keys(action).forEach((key) => {\n                    action[key] = atob(action[key]);\n                });\n            });\n            for (let i = 0; i < context.segments.length; i++) {\n                context.segments[i] = atob(context.segments[i]);\n            }\n            return context;\n        }\n    }\n}\nPersonalizationContextService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: \"12.0.0\", version: \"12.0.5\", ngImport: i0, type: PersonalizationContextService, deps: [{ token: i1.PersonalizationConfig }, { token: i2.CmsService }], target: i0.ɵɵFactoryTarget.Injectable });\nPersonalizationContextService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: \"12.0.0\", version: \"12.0.5\", ngImport: i0, type: PersonalizationContextService, providedIn: 'root' });\ni0.ɵɵngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"12.0.5\", ngImport: i0, type: PersonalizationContextService, decorators: [{\n            type: Injectable,\n            args: [{\n                    providedIn: 'root',\n                }]\n        }], ctorParameters: function () { return [{ type: i1.PersonalizationConfig }, { type: i2.CmsService }]; } });\n\n/**\n * Generated bundle index. Do not edit.\n */\n\nexport { PersonalizationContextService, PersonalizationCoreModule };\n//# sourceMappingURL=spartacus-tracking-personalization-core.js.map\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}