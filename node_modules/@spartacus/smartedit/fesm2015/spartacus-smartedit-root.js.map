{"version":3,"file":"spartacus-smartedit-root.js","sources":["../../../feature-libs/smartedit/root/config/smart-edit-config.ts","../../../feature-libs/smartedit/root/feature-name.ts","../../../feature-libs/smartedit/root/services/smart-edit-launcher.service.ts","../../../feature-libs/smartedit/root/config/default-smart-edit-config.ts","../../../feature-libs/smartedit/root/http-interceptors/cms-ticket.interceptor.ts","../../../feature-libs/smartedit/root/http-interceptors/index.ts","../../../feature-libs/smartedit/root/smart-edit-root.module.ts","../../../feature-libs/smartedit/root/spartacus-smartedit-root.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { Config } from '@spartacus/core';\n\n@Injectable({\n  providedIn: 'root',\n  useExisting: Config,\n})\nexport abstract class SmartEditConfig {\n  smartEdit?: {\n    storefrontPreviewRoute?: string;\n    allowOrigin?: string;\n  };\n}\n\ndeclare module '@spartacus/core' {\n  interface Config extends SmartEditConfig {}\n}\n","export const SMART_EDIT_FEATURE = 'smartEdit';\n","import { Location } from '@angular/common';\nimport { Injectable } from '@angular/core';\nimport { FeatureModulesService } from '@spartacus/core';\nimport { SmartEditConfig } from '../config/smart-edit-config';\n\n/**\n * The SmartEditLauncherService is used to check whether Spartacus is launched inside Smart Edit;\n * it also gets cmsTicketId sent from Smart Edit.\n */\n@Injectable({\n  providedIn: 'root',\n})\nexport class SmartEditLauncherService {\n  private _cmsTicketId: string | undefined;\n\n  get cmsTicketId(): string | undefined {\n    return this._cmsTicketId;\n  }\n\n  constructor(\n    protected config: SmartEditConfig,\n    protected location: Location,\n    protected featureModules: FeatureModulesService\n  ) {}\n\n  /**\n   * Lazy loads modules when Spartacus launced inside Smart Edit\n   */\n  load(): void {\n    if (\n      this.isLaunchedInSmartEdit() &&\n      this.featureModules.isConfigured('smartEdit')\n    ) {\n      this.featureModules.resolveFeature('smartEdit').subscribe();\n    }\n  }\n\n  /**\n   * Indicates whether Spartacus is launched in SmartEdit\n   */\n  isLaunchedInSmartEdit(): boolean {\n    const path = this.location.path().split('?')[0];\n    const params = this.location.path().split('?')[1];\n    const cmsToken = params\n      ?.split('&')\n      .find((param) => param.startsWith('cmsTicketId='));\n    this._cmsTicketId = cmsToken?.split('=')[1];\n\n    return (\n      path.split('/').pop() === this.config.smartEdit?.storefrontPreviewRoute &&\n      !!this._cmsTicketId\n    );\n  }\n}\n","import { SmartEditConfig } from './smart-edit-config';\n\nexport const defaultSmartEditConfig: SmartEditConfig = {\n  smartEdit: {\n    storefrontPreviewRoute: 'cx-preview',\n    allowOrigin: 'localhost:9002',\n  },\n};\n","import {\n  HttpEvent,\n  HttpHandler,\n  HttpInterceptor,\n  HttpRequest,\n} from '@angular/common/http';\nimport { Injectable } from '@angular/core';\nimport { Observable } from 'rxjs';\nimport { SmartEditLauncherService } from '../services/smart-edit-launcher.service';\n\n@Injectable({ providedIn: 'root' })\nexport class CmsTicketInterceptor implements HttpInterceptor {\n  constructor(private service: SmartEditLauncherService) {}\n\n  intercept(\n    request: HttpRequest<any>,\n    next: HttpHandler\n  ): Observable<HttpEvent<any>> {\n    if (this.service.cmsTicketId && request.url.includes('/cms/')) {\n      request = request.clone({\n        setParams: {\n          cmsTicketId: this.service.cmsTicketId,\n        },\n      });\n    }\n\n    return next.handle(request);\n  }\n}\n","import { HTTP_INTERCEPTORS } from '@angular/common/http';\nimport { Provider } from '@angular/core';\nimport { CmsTicketInterceptor } from './cms-ticket.interceptor';\n\nexport const interceptors: Provider[] = [\n  {\n    provide: HTTP_INTERCEPTORS,\n    useExisting: CmsTicketInterceptor,\n    multi: true,\n  },\n];\n","import { APP_INITIALIZER, NgModule } from '@angular/core';\nimport { provideDefaultConfig } from '@spartacus/core';\nimport { defaultSmartEditConfig } from './config/default-smart-edit-config';\nimport { interceptors } from './http-interceptors/index';\nimport { SmartEditLauncherService } from './services/smart-edit-launcher.service';\n\nexport function smartEditFactory(\n  smartEditLauncherService: SmartEditLauncherService\n): () => void {\n  const isReady = () => {\n    smartEditLauncherService.load();\n  };\n  return isReady;\n}\n\n@NgModule({\n  providers: [\n    ...interceptors,\n    provideDefaultConfig(defaultSmartEditConfig),\n    {\n      provide: APP_INITIALIZER,\n      useFactory: smartEditFactory,\n      deps: [SmartEditLauncherService],\n      multi: true,\n    },\n  ],\n})\nexport class SmartEditRootModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":[],"mappings":"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"}