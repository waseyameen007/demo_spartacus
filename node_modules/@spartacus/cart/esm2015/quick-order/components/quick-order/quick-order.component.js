import { ChangeDetectionStrategy, Component, ViewChild, } from '@angular/core';
import { GlobalMessageType, } from '@spartacus/core';
import { BehaviorSubject, combineLatest } from 'rxjs';
import { first, map, tap } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "@spartacus/core";
import * as i2 from "@spartacus/storefront";
import * as i3 from "@spartacus/cart/quick-order/root";
import * as i4 from "@spartacus/cart/quick-order/core";
import * as i5 from "./form/quick-order-form.component";
import * as i6 from "./table/quick-order-table.component";
import * as i7 from "@angular/common";
export class QuickOrderComponent {
    constructor(activeCartService, component, globalMessageService, quickOrderService, quickOrderStatePersistenceService) {
        this.activeCartService = activeCartService;
        this.component = component;
        this.globalMessageService = globalMessageService;
        this.quickOrderService = quickOrderService;
        this.quickOrderStatePersistenceService = quickOrderStatePersistenceService;
        this.quickOrderListLimit$ = this.component.data$.pipe(map((data) => data.quickOrderListLimit), tap((limit) => {
            if (!!limit) {
                this.quickOrderService.setListLimit(limit);
            }
        }));
        this.isCartStable$ = combineLatest([
            this.activeCartService.getActiveCartId(),
            this.activeCartService.isStable(),
        ]).pipe(map(([activeCartId, isStable]) => (!activeCartId ? true : isStable)));
        this.globalMessageType = GlobalMessageType;
        this.cartErrors$ = new BehaviorSubject([]);
        this.cartWarnings$ = new BehaviorSubject([]);
        this.cartSuccesses$ = new BehaviorSubject([]);
        this.showAddToCartInformation$ = new BehaviorSubject(false);
        this.nonPurchasableProductError$ = new BehaviorSubject(null);
    }
    ngOnInit() {
        this.cartId$ = this.activeCartService.getActiveCartId();
        this.entries$ = this.quickOrderService.getEntries();
        this.quickOrderStatePersistenceService.initSync();
    }
    ngOnDestroy() {
        this.quickOrderService.clearDeletedEntries();
    }
    get errors$() {
        return this.cartErrors$.asObservable();
    }
    get warnings$() {
        return this.cartWarnings$.asObservable();
    }
    get successes$() {
        return this.cartSuccesses$.asObservable();
    }
    get nonPurchasableError$() {
        return this.quickOrderService.getNonPurchasableProductError();
    }
    get addToCartInformation$() {
        return this.showAddToCartInformation$.asObservable();
    }
    get softDeletedEntries$() {
        return this.quickOrderService.getSoftDeletedEntries();
    }
    clear() {
        this.quickOrderService.clearList();
        this.globalMessageService.add({
            key: 'quickOrderTable.listCleared',
        }, GlobalMessageType.MSG_TYPE_INFO);
    }
    addToCart(orderEntries) {
        if (!orderEntries.length) {
            this.showAddToCartInformation$.next(true);
            return;
        }
        this.clearStatuses();
        this.quickOrderService
            .addToCart()
            .pipe(first())
            .subscribe(([entries, errors]) => {
            errors.forEach((err) => {
                if (!err.entry) {
                    err.entry = orderEntries.find((e) => { var _a; return ((_a = e.product) === null || _a === void 0 ? void 0 : _a.code) === err.productCode; });
                }
            });
            this.extractErrors(errors);
            this.extractWarnings(errors);
            if (!errors.length) {
                this.showAddedToCartSuccessMessage();
            }
            else {
                this.extractSuccesses(errors, entries);
            }
        });
    }
    clearErrors() {
        this.cartErrors$.next([]);
    }
    clearWarnings() {
        this.cartWarnings$.next([]);
    }
    clearSuccesses() {
        this.cartSuccesses$.next([]);
    }
    clearAddToCartInformation() {
        this.showAddToCartInformation$.next(false);
    }
    undoDeletion(entry) {
        var _a;
        if ((_a = entry.product) === null || _a === void 0 ? void 0 : _a.code) {
            this.quickOrderService.restoreSoftDeletedEntry(entry.product.code);
        }
    }
    clearDeletion(entry) {
        var _a;
        if ((_a = entry.product) === null || _a === void 0 ? void 0 : _a.code) {
            this.quickOrderService.hardDeleteEntry(entry.product.code);
        }
    }
    clearNonPurchasableError() {
        this.quickOrderService.clearNonPurchasableProductError();
    }
    canAddProduct() {
        return this.quickOrderService.canAdd();
    }
    extractErrors(errors) {
        const noAddedEntries = errors.filter((error) => error.quantityAdded === 0);
        this.setErrors(noAddedEntries);
    }
    extractWarnings(errors) {
        const warnings = errors.filter((error) => error.quantityAdded !== 0);
        this.setWarnings(warnings);
    }
    extractSuccesses(errors, entries) {
        const successAddedEntries = [];
        entries.forEach((entry) => {
            const element = errors.find((error) => { var _a; return error.productCode === ((_a = entry.product) === null || _a === void 0 ? void 0 : _a.code); });
            if (!element) {
                successAddedEntries.push(entry);
            }
        });
        this.setSuccesses(successAddedEntries);
    }
    clearStatuses() {
        this.clearErrors();
        this.clearWarnings();
        this.clearSuccesses();
    }
    showAddedToCartSuccessMessage() {
        this.globalMessageService.add({
            key: 'quickOrderTable.addedtoCart',
        }, GlobalMessageType.MSG_TYPE_CONFIRMATION);
    }
    setErrors(errors) {
        this.cartErrors$.next(errors);
    }
    setWarnings(warnings) {
        this.cartWarnings$.next(warnings);
    }
    setSuccesses(entries) {
        this.cartSuccesses$.next(entries);
    }
}
QuickOrderComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.0.5", ngImport: i0, type: QuickOrderComponent, deps: [{ token: i1.ActiveCartService }, { token: i2.CmsComponentData }, { token: i1.GlobalMessageService }, { token: i3.QuickOrderFacade }, { token: i4.QuickOrderStatePersistenceService }], target: i0.ɵɵFactoryTarget.Component });
QuickOrderComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.0.5", type: QuickOrderComponent, selector: "cx-quick-order", viewQueries: [{ propertyName: "quickOrderForm", first: true, predicate: ["quickOrderForm"], descendants: true }], ngImport: i0, template: "<ng-container *ngIf=\"entries$ | async as entries\">\n  <ng-container *ngIf=\"!(canAddProduct() | async)\">\n    <ng-container *ngIf=\"quickOrderForm?.form?.get('product')?.dirty\">\n      <cx-message\n        [text]=\"\n          'quickOrderList.errors.listIsFull'\n            | cxTranslate: { count: entries.length }\n        \"\n        [isVisibleCloseButton]=\"false\"\n        [type]=\"globalMessageType.MSG_TYPE_ERROR\"\n        class=\"quick-order-list-limit-message\"\n      >\n      </cx-message>\n    </ng-container>\n  </ng-container>\n</ng-container>\n\n<ng-container *ngIf=\"addToCartInformation$ | async\">\n  <cx-message\n    (closeMessage)=\"clearAddToCartInformation()\"\n    [text]=\"\n      'quickOrderList.informations.addProductBeforeAddingToCart' | cxTranslate\n    \"\n    [type]=\"globalMessageType.MSG_TYPE_ERROR\"\n    class=\"quick-order-add-to-cart-information-message\"\n  >\n  </cx-message>\n</ng-container>\n\n<ng-container *ngIf=\"nonPurchasableError$ | async as nonPurchasableError\">\n  <cx-message\n    (closeMessage)=\"clearNonPurchasableError()\"\n    [text]=\"\n      'quickOrderList.errors.nonPurchasableError'\n        | cxTranslate: { name: nonPurchasableError.name }\n    \"\n    [type]=\"globalMessageType.MSG_TYPE_ERROR\"\n    class=\"quick-order-non-purchasable-product-error-message\"\n  >\n  </cx-message>\n</ng-container>\n\n<ng-container *ngIf=\"softDeletedEntries$ | async as deletedEntries\">\n  <cx-message\n    *ngFor=\"let deletedEntry of deletedEntries | keyvalue\"\n    (buttonAction)=\"undoDeletion(deletedEntry.value)\"\n    (closeMessage)=\"clearDeletion(deletedEntry.value)\"\n    [actionButtonText]=\"'quickOrderList.undo' | cxTranslate\"\n    [text]=\"\n      'quickOrderList.productWasDeleted'\n        | cxTranslate: { name: deletedEntry.value.product?.name }\n    \"\n    [type]=\"globalMessageType.MSG_TYPE_CONFIRMATION\"\n    class=\"quick-order-deletions-message\"\n  >\n  </cx-message>\n</ng-container>\n\n<ng-container *ngIf=\"errors$ | async as errors\">\n  <cx-message\n    *ngIf=\"errors.length\"\n    (closeMessage)=\"clearErrors()\"\n    [accordionText]=\"'quickOrderList.errors.reviewErrors' | cxTranslate\"\n    [text]=\"'quickOrderList.errorProceedingToCart' | cxTranslate\"\n    [type]=\"globalMessageType.MSG_TYPE_ERROR\"\n    class=\"quick-order-errors-message\"\n  >\n    <ul class=\"quick-order-errors\">\n      <li *ngFor=\"let error of errors\" class=\"quick-order-error-item\">\n        <span>\n          {{\n            'quickOrderList.errors.productIsOutOfStock'\n              | cxTranslate\n                : {\n                    name: error.entry.product.name,\n                    code: error.entry.product.code\n                  }\n          }}\n        </span>\n      </li>\n    </ul>\n  </cx-message>\n</ng-container>\n\n<ng-container *ngIf=\"warnings$ | async as warnings\">\n  <cx-message\n    *ngIf=\"warnings.length\"\n    (closeMessage)=\"clearWarnings()\"\n    [accordionText]=\"'quickOrderList.warnings.reviewWarnings' | cxTranslate\"\n    [text]=\"'quickOrderList.warningProceedingToCart' | cxTranslate\"\n    [type]=\"globalMessageType.MSG_TYPE_WARNING\"\n    class=\"quick-order-warnings-message\"\n  >\n    <ul class=\"quick-order-warnings\">\n      <li *ngFor=\"let warning of warnings\" class=\"quick-order-warning-item\">\n        <span>\n          {{\n            'quickOrderList.warnings.productWasReduced'\n              | cxTranslate\n                : {\n                    name: warning.entry.product.name,\n                    code: warning.entry.product.code,\n                    quantityAdded: warning.quantityAdded\n                  }\n          }}\n        </span>\n      </li>\n    </ul>\n  </cx-message>\n</ng-container>\n\n<ng-container *ngIf=\"successes$ | async as successes\">\n  <cx-message\n    *ngIf=\"successes.length\"\n    (closeMessage)=\"clearSuccesses()\"\n    [text]=\"'quickOrderList.successfullyAddedToCart' | cxTranslate\"\n    [type]=\"globalMessageType.MSG_TYPE_CONFIRMATION\"\n    class=\"quick-order-successes-message\"\n  >\n    <ul class=\"quick-order-successes\">\n      <li *ngFor=\"let entry of successes\" class=\"quick-order-success-item\">\n        <span>{{\n          'quickOrderList.successes.productAddedToCart'\n            | cxTranslate\n              : {\n                  name: entry.product.name,\n                  code: entry.product.code\n                }\n        }}</span>\n      </li>\n    </ul>\n  </cx-message>\n</ng-container>\n\n<ng-container *ngIf=\"quickOrderListLimit$ | async as quickOrderListLimit\">\n  <ng-container *ngIf=\"entries$ | async as entries\">\n    <div class=\"quick-order-header\">\n      <h3>{{ 'quickOrderList.header' | cxTranslate }}</h3>\n      <p>\n        {{\n          'quickOrderList.subHeader'\n            | cxTranslate: { limit: quickOrderListLimit }\n        }}\n      </p>\n    </div>\n\n    <div class=\"quick-order-form-body\">\n      <cx-quick-order-form #quickOrderForm> </cx-quick-order-form>\n    </div>\n\n    <div class=\"quick-order-table-body\">\n      <cx-quick-order-table\n        [entries]=\"entries\"\n        [loading]=\"!(isCartStable$ | async)\"\n      ></cx-quick-order-table>\n    </div>\n\n    <div class=\"quick-order-footer row\">\n      <div class=\"col-xs-12 col-md-5 col-lg-4\">\n        <button\n          *ngIf=\"entries.length\"\n          (click)=\"clear()\"\n          [attr.aria-label]=\"'quickOrderList.emptyList' | cxTranslate\"\n          [disabled]=\"!(isCartStable$ | async)\"\n          class=\"btn btn-block btn-action clear-button\"\n          type=\"button\"\n        >\n          {{ 'quickOrderList.emptyList' | cxTranslate }}\n        </button>\n      </div>\n\n      <div class=\"col-xs-12 col-md-5 col-lg-4\">\n        <cx-progress-button\n          (clikEvent)=\"addToCart(entries)\"\n          [ariaLabel]=\"'quickOrderList.addToCart' | cxTranslate\"\n          [class]=\"'btn-block add-button'\"\n          [loading]=\"!(isCartStable$ | async)\"\n        >\n          {{ 'quickOrderList.addToCart' | cxTranslate }}\n        </cx-progress-button>\n      </div>\n    </div>\n  </ng-container>\n</ng-container>\n", components: [{ type: i2.MessageComponent, selector: "cx-message", inputs: ["text", "actionButtonText", "accordionText", "showBody", "isVisibleCloseButton", "type"], outputs: ["closeMessage", "buttonAction"] }, { type: i5.QuickOrderFormComponent, selector: "cx-quick-order-form" }, { type: i6.QuickOrderTableComponent, selector: "cx-quick-order-table", inputs: ["entries", "loading"] }, { type: i2.ProgressButtonComponent, selector: "cx-progress-button", inputs: ["ariaLabel", "class", "disabled", "loading"], outputs: ["clikEvent"] }], directives: [{ type: i7.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i7.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }], pipes: { "async": i7.AsyncPipe, "cxTranslate": i1.TranslatePipe, "keyvalue": i7.KeyValuePipe }, changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.0.5", ngImport: i0, type: QuickOrderComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'cx-quick-order',
                    templateUrl: './quick-order.component.html',
                    changeDetection: ChangeDetectionStrategy.OnPush,
                }]
        }], ctorParameters: function () { return [{ type: i1.ActiveCartService }, { type: i2.CmsComponentData }, { type: i1.GlobalMessageService }, { type: i3.QuickOrderFacade }, { type: i4.QuickOrderStatePersistenceService }]; }, propDecorators: { quickOrderForm: [{
                type: ViewChild,
                args: ['quickOrderForm']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicXVpY2stb3JkZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vZmVhdHVyZS1saWJzL2NhcnQvcXVpY2stb3JkZXIvY29tcG9uZW50cy9xdWljay1vcmRlci9xdWljay1vcmRlci5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi9mZWF0dXJlLWxpYnMvY2FydC9xdWljay1vcmRlci9jb21wb25lbnRzL3F1aWNrLW9yZGVyL3F1aWNrLW9yZGVyLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCx1QkFBdUIsRUFDdkIsU0FBUyxFQUdULFNBQVMsR0FDVixNQUFNLGVBQWUsQ0FBQztBQVN2QixPQUFPLEVBR0wsaUJBQWlCLEdBR2xCLE1BQU0saUJBQWlCLENBQUM7QUFFekIsT0FBTyxFQUFFLGVBQWUsRUFBRSxhQUFhLEVBQWMsTUFBTSxNQUFNLENBQUM7QUFDbEUsT0FBTyxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7Ozs7Ozs7OztBQVFqRCxNQUFNLE9BQU8sbUJBQW1CO0lBOEI5QixZQUNZLGlCQUFvQyxFQUNwQyxTQUFtRCxFQUNuRCxvQkFBMEMsRUFDMUMsaUJBQW1DLEVBQ25DLGlDQUFvRTtRQUpwRSxzQkFBaUIsR0FBakIsaUJBQWlCLENBQW1CO1FBQ3BDLGNBQVMsR0FBVCxTQUFTLENBQTBDO1FBQ25ELHlCQUFvQixHQUFwQixvQkFBb0IsQ0FBc0I7UUFDMUMsc0JBQWlCLEdBQWpCLGlCQUFpQixDQUFrQjtRQUNuQyxzQ0FBaUMsR0FBakMsaUNBQWlDLENBQW1DO1FBaENoRix5QkFBb0IsR0FDbEIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUN2QixHQUFHLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxFQUN2QyxH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Y0FBYztzQkFEYixTQUFTO3VCQUFDLGdCQUFnQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBDb21wb25lbnQsXG4gIE9uRGVzdHJveSxcbiAgT25Jbml0LFxuICBWaWV3Q2hpbGQsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtcbiAgQ21zUXVpY2tPcmRlckNvbXBvbmVudCxcbiAgUXVpY2tPcmRlclN0YXRlUGVyc2lzdGVuY2VTZXJ2aWNlLFxufSBmcm9tICdAc3BhcnRhY3VzL2NhcnQvcXVpY2stb3JkZXIvY29yZSc7XG5pbXBvcnQge1xuICBRdWlja09yZGVyQWRkRW50cnlFdmVudCxcbiAgUXVpY2tPcmRlckZhY2FkZSxcbn0gZnJvbSAnQHNwYXJ0YWN1cy9jYXJ0L3F1aWNrLW9yZGVyL3Jvb3QnO1xuaW1wb3J0IHtcbiAgQWN0aXZlQ2FydFNlcnZpY2UsXG4gIEdsb2JhbE1lc3NhZ2VTZXJ2aWNlLFxuICBHbG9iYWxNZXNzYWdlVHlwZSxcbiAgT3JkZXJFbnRyeSxcbiAgUHJvZHVjdCxcbn0gZnJvbSAnQHNwYXJ0YWN1cy9jb3JlJztcbmltcG9ydCB7IENtc0NvbXBvbmVudERhdGEgfSBmcm9tICdAc3BhcnRhY3VzL3N0b3JlZnJvbnQnO1xuaW1wb3J0IHsgQmVoYXZpb3JTdWJqZWN0LCBjb21iaW5lTGF0ZXN0LCBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBmaXJzdCwgbWFwLCB0YXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBRdWlja09yZGVyRm9ybUNvbXBvbmVudCB9IGZyb20gJy4vZm9ybS9xdWljay1vcmRlci1mb3JtLmNvbXBvbmVudCc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2N4LXF1aWNrLW9yZGVyJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3F1aWNrLW9yZGVyLmNvbXBvbmVudC5odG1sJyxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG59KVxuZXhwb3J0IGNsYXNzIFF1aWNrT3JkZXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSB7XG4gIGNhcnRJZCQ6IE9ic2VydmFibGU8c3RyaW5nPjtcbiAgZW50cmllcyQ6IE9ic2VydmFibGU8T3JkZXJFbnRyeVtdPjtcbiAgcXVpY2tPcmRlckxpc3RMaW1pdCQ6IE9ic2VydmFibGU8bnVtYmVyIHwgdW5kZWZpbmVkPiA9XG4gICAgdGhpcy5jb21wb25lbnQuZGF0YSQucGlwZShcbiAgICAgIG1hcCgoZGF0YSkgPT4gZGF0YS5xdWlja09yZGVyTGlzdExpbWl0KSxcbiAgICAgIHRhcCgobGltaXQpID0+IHtcbiAgICAgICAgaWYgKCEhbGltaXQpIHtcbiAgICAgICAgICB0aGlzLnF1aWNrT3JkZXJTZXJ2aWNlLnNldExpc3RMaW1pdChsaW1pdCk7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgKTtcbiAgaXNDYXJ0U3RhYmxlJDogT2JzZXJ2YWJsZTxib29sZWFuPiA9IGNvbWJpbmVMYXRlc3QoW1xuICAgIHRoaXMuYWN0aXZlQ2FydFNlcnZpY2UuZ2V0QWN0aXZlQ2FydElkKCksXG4gICAgdGhpcy5hY3RpdmVDYXJ0U2VydmljZS5pc1N0YWJsZSgpLFxuICBdKS5waXBlKG1hcCgoW2FjdGl2ZUNhcnRJZCwgaXNTdGFibGVdKSA9PiAoIWFjdGl2ZUNhcnRJZCA/IHRydWUgOiBpc1N0YWJsZSkpKTtcbiAgZ2xvYmFsTWVzc2FnZVR5cGUgPSBHbG9iYWxNZXNzYWdlVHlwZTtcbiAgbGlzdExpbWl0UmVhY2hlZCQ6IE9ic2VydmFibGU8Ym9vbGVhbj47XG5cbiAgQFZpZXdDaGlsZCgncXVpY2tPcmRlckZvcm0nKVxuICBxdWlja09yZGVyRm9ybTogUXVpY2tPcmRlckZvcm1Db21wb25lbnQ7XG5cbiAgcHJvdGVjdGVkIGNhcnRFcnJvcnMkID0gbmV3IEJlaGF2aW9yU3ViamVjdDxRdWlja09yZGVyQWRkRW50cnlFdmVudFtdPihbXSk7XG4gIHByb3RlY3RlZCBjYXJ0V2FybmluZ3MkID0gbmV3IEJlaGF2aW9yU3ViamVjdDxRdWlja09yZGVyQWRkRW50cnlFdmVudFtdPihbXSk7XG4gIHByb3RlY3RlZCBjYXJ0U3VjY2Vzc2VzJCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8T3JkZXJFbnRyeVtdPihbXSk7XG4gIHByb3RlY3RlZCBzaG93QWRkVG9DYXJ0SW5mb3JtYXRpb24kID0gbmV3IEJlaGF2aW9yU3ViamVjdDxib29sZWFuPihmYWxzZSk7XG4gIHByb3RlY3RlZCBub25QdXJjaGFzYWJsZVByb2R1Y3RFcnJvciQgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PFByb2R1Y3QgfCBudWxsPihcbiAgICBudWxsXG4gICk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJvdGVjdGVkIGFjdGl2ZUNhcnRTZXJ2aWNlOiBBY3RpdmVDYXJ0U2VydmljZSxcbiAgICBwcm90ZWN0ZWQgY29tcG9uZW50OiBDbXNDb21wb25lbnREYXRhPENtc1F1aWNrT3JkZXJDb21wb25lbnQ+LFxuICAgIHByb3RlY3RlZCBnbG9iYWxNZXNzYWdlU2VydmljZTogR2xvYmFsTWVzc2FnZVNlcnZpY2UsXG4gICAgcHJvdGVjdGVkIHF1aWNrT3JkZXJTZXJ2aWNlOiBRdWlja09yZGVyRmFjYWRlLFxuICAgIHByb3RlY3RlZCBxdWlja09yZGVyU3RhdGVQZXJzaXN0ZW5jZVNlcnZpY2U6IFF1aWNrT3JkZXJTdGF0ZVBlcnNpc3RlbmNlU2VydmljZVxuICApIHt9XG5cbiAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgdGhpcy5jYXJ0SWQkID0gdGhpcy5hY3RpdmVDYXJ0U2VydmljZS5nZXRBY3RpdmVDYXJ0SWQoKTtcbiAgICB0aGlzLmVudHJpZXMkID0gdGhpcy5xdWlja09yZGVyU2VydmljZS5nZXRFbnRyaWVzKCk7XG4gICAgdGhpcy5xdWlja09yZGVyU3RhdGVQZXJzaXN0ZW5jZVNlcnZpY2UuaW5pdFN5bmMoKTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIHRoaXMucXVpY2tPcmRlclNlcnZpY2UuY2xlYXJEZWxldGVkRW50cmllcygpO1xuICB9XG5cbiAgZ2V0IGVycm9ycyQoKTogT2JzZXJ2YWJsZTxRdWlja09yZGVyQWRkRW50cnlFdmVudFtdPiB7XG4gICAgcmV0dXJuIHRoaXMuY2FydEVycm9ycyQuYXNPYnNlcnZhYmxlKCk7XG4gIH1cblxuICBnZXQgd2FybmluZ3MkKCk6IE9ic2VydmFibGU8UXVpY2tPcmRlckFkZEVudHJ5RXZlbnRbXT4ge1xuICAgIHJldHVybiB0aGlzLmNhcnRXYXJuaW5ncyQuYXNPYnNlcnZhYmxlKCk7XG4gIH1cblxuICBnZXQgc3VjY2Vzc2VzJCgpOiBPYnNlcnZhYmxlPE9yZGVyRW50cnlbXT4ge1xuICAgIHJldHVybiB0aGlzLmNhcnRTdWNjZXNzZXMkLmFzT2JzZXJ2YWJsZSgpO1xuICB9XG5cbiAgZ2V0IG5vblB1cmNoYXNhYmxlRXJyb3IkKCk6IE9ic2VydmFibGU8UHJvZHVjdCB8IG51bGw+IHtcbiAgICByZXR1cm4gdGhpcy5xdWlja09yZGVyU2VydmljZS5nZXROb25QdXJjaGFzYWJsZVByb2R1Y3RFcnJvcigpO1xuICB9XG5cbiAgZ2V0IGFkZFRvQ2FydEluZm9ybWF0aW9uJCgpOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcbiAgICByZXR1cm4gdGhpcy5zaG93QWRkVG9DYXJ0SW5mb3JtYXRpb24kLmFzT2JzZXJ2YWJsZSgpO1xuICB9XG5cbiAgZ2V0IHNvZnREZWxldGVkRW50cmllcyQoKTogT2JzZXJ2YWJsZTxSZWNvcmQ8c3RyaW5nLCBPcmRlckVudHJ5Pj4ge1xuICAgIHJldHVybiB0aGlzLnF1aWNrT3JkZXJTZXJ2aWNlLmdldFNvZnREZWxldGVkRW50cmllcygpO1xuICB9XG5cbiAgY2xlYXIoKTogdm9pZCB7XG4gICAgdGhpcy5xdWlja09yZGVyU2VydmljZS5jbGVhckxpc3QoKTtcbiAgICB0aGlzLmdsb2JhbE1lc3NhZ2VTZXJ2aWNlLmFkZChcbiAgICAgIHtcbiAgICAgICAga2V5OiAncXVpY2tPcmRlclRhYmxlLmxpc3RDbGVhcmVkJyxcbiAgICAgIH0sXG4gICAgICBHbG9iYWxNZXNzYWdlVHlwZS5NU0dfVFlQRV9JTkZPXG4gICAgKTtcbiAgfVxuXG4gIGFkZFRvQ2FydChvcmRlckVudHJpZXM6IE9yZGVyRW50cnlbXSk6IHZvaWQge1xuICAgIGlmICghb3JkZXJFbnRyaWVzLmxlbmd0aCkge1xuICAgICAgdGhpcy5zaG93QWRkVG9DYXJ0SW5mb3JtYXRpb24kLm5leHQodHJ1ZSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5jbGVhclN0YXR1c2VzKCk7XG5cbiAgICB0aGlzLnF1aWNrT3JkZXJTZXJ2aWNlXG4gICAgICAuYWRkVG9DYXJ0KClcbiAgICAgIC5waXBlKGZpcnN0KCkpXG4gICAgICAuc3Vic2NyaWJlKChbZW50cmllcywgZXJyb3JzXSkgPT4ge1xuICAgICAgICBlcnJvcnMuZm9yRWFjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgaWYgKCFlcnIuZW50cnkpIHtcbiAgICAgICAgICAgIGVyci5lbnRyeSA9IG9yZGVyRW50cmllcy5maW5kKFxuICAgICAgICAgICAgICAoZSkgPT4gZS5wcm9kdWN0Py5jb2RlID09PSBlcnIucHJvZHVjdENvZGVcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmV4dHJhY3RFcnJvcnMoZXJyb3JzKTtcbiAgICAgICAgdGhpcy5leHRyYWN0V2FybmluZ3MoZXJyb3JzKTtcblxuICAgICAgICBpZiAoIWVycm9ycy5sZW5ndGgpIHtcbiAgICAgICAgICB0aGlzLnNob3dBZGRlZFRvQ2FydFN1Y2Nlc3NNZXNzYWdlKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5leHRyYWN0U3VjY2Vzc2VzKGVycm9ycywgZW50cmllcyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICB9XG5cbiAgY2xlYXJFcnJvcnMoKTogdm9pZCB7XG4gICAgdGhpcy5jYXJ0RXJyb3JzJC5uZXh0KFtdKTtcbiAgfVxuXG4gIGNsZWFyV2FybmluZ3MoKTogdm9pZCB7XG4gICAgdGhpcy5jYXJ0V2FybmluZ3MkLm5leHQoW10pO1xuICB9XG5cbiAgY2xlYXJTdWNjZXNzZXMoKTogdm9pZCB7XG4gICAgdGhpcy5jYXJ0U3VjY2Vzc2VzJC5uZXh0KFtdKTtcbiAgfVxuXG4gIGNsZWFyQWRkVG9DYXJ0SW5mb3JtYXRpb24oKTogdm9pZCB7XG4gICAgdGhpcy5zaG93QWRkVG9DYXJ0SW5mb3JtYXRpb24kLm5leHQoZmFsc2UpO1xuICB9XG5cbiAgdW5kb0RlbGV0aW9uKGVudHJ5OiBPcmRlckVudHJ5KTogdm9pZCB7XG4gICAgaWYgKGVudHJ5LnByb2R1Y3Q/LmNvZGUpIHtcbiAgICAgIHRoaXMucXVpY2tPcmRlclNlcnZpY2UucmVzdG9yZVNvZnREZWxldGVkRW50cnkoZW50cnkucHJvZHVjdC5jb2RlKTtcbiAgICB9XG4gIH1cblxuICBjbGVhckRlbGV0aW9uKGVudHJ5OiBPcmRlckVudHJ5KTogdm9pZCB7XG4gICAgaWYgKGVudHJ5LnByb2R1Y3Q/LmNvZGUpIHtcbiAgICAgIHRoaXMucXVpY2tPcmRlclNlcnZpY2UuaGFyZERlbGV0ZUVudHJ5KGVudHJ5LnByb2R1Y3QuY29kZSk7XG4gICAgfVxuICB9XG5cbiAgY2xlYXJOb25QdXJjaGFzYWJsZUVycm9yKCk6IHZvaWQge1xuICAgIHRoaXMucXVpY2tPcmRlclNlcnZpY2UuY2xlYXJOb25QdXJjaGFzYWJsZVByb2R1Y3RFcnJvcigpO1xuICB9XG5cbiAgY2FuQWRkUHJvZHVjdCgpOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcbiAgICByZXR1cm4gdGhpcy5xdWlja09yZGVyU2VydmljZS5jYW5BZGQoKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBleHRyYWN0RXJyb3JzKGVycm9yczogUXVpY2tPcmRlckFkZEVudHJ5RXZlbnRbXSk6IHZvaWQge1xuICAgIGNvbnN0IG5vQWRkZWRFbnRyaWVzID0gZXJyb3JzLmZpbHRlcigoZXJyb3IpID0+IGVycm9yLnF1YW50aXR5QWRkZWQgPT09IDApO1xuXG4gICAgdGhpcy5zZXRFcnJvcnMobm9BZGRlZEVudHJpZXMpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGV4dHJhY3RXYXJuaW5ncyhlcnJvcnM6IFF1aWNrT3JkZXJBZGRFbnRyeUV2ZW50W10pOiB2b2lkIHtcbiAgICBjb25zdCB3YXJuaW5ncyA9IGVycm9ycy5maWx0ZXIoKGVycm9yKSA9PiBlcnJvci5xdWFudGl0eUFkZGVkICE9PSAwKTtcblxuICAgIHRoaXMuc2V0V2FybmluZ3Mod2FybmluZ3MpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGV4dHJhY3RTdWNjZXNzZXMoXG4gICAgZXJyb3JzOiBRdWlja09yZGVyQWRkRW50cnlFdmVudFtdLFxuICAgIGVudHJpZXM6IE9yZGVyRW50cnlbXVxuICApOiB2b2lkIHtcbiAgICBjb25zdCBzdWNjZXNzQWRkZWRFbnRyaWVzOiBPcmRlckVudHJ5W10gPSBbXTtcblxuICAgIGVudHJpZXMuZm9yRWFjaCgoZW50cnkpID0+IHtcbiAgICAgIGNvbnN0IGVsZW1lbnQgPSBlcnJvcnMuZmluZChcbiAgICAgICAgKGVycm9yKSA9PiBlcnJvci5wcm9kdWN0Q29kZSA9PT0gZW50cnkucHJvZHVjdD8uY29kZVxuICAgICAgKTtcbiAgICAgIGlmICghZWxlbWVudCkge1xuICAgICAgICBzdWNjZXNzQWRkZWRFbnRyaWVzLnB1c2goZW50cnkpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdGhpcy5zZXRTdWNjZXNzZXMoc3VjY2Vzc0FkZGVkRW50cmllcyk7XG4gIH1cblxuICBwcm90ZWN0ZWQgY2xlYXJTdGF0dXNlcygpOiB2b2lkIHtcbiAgICB0aGlzLmNsZWFyRXJyb3JzKCk7XG4gICAgdGhpcy5jbGVhcldhcm5pbmdzKCk7XG4gICAgdGhpcy5jbGVhclN1Y2Nlc3NlcygpO1xuICB9XG5cbiAgcHJvdGVjdGVkIHNob3dBZGRlZFRvQ2FydFN1Y2Nlc3NNZXNzYWdlKCk6IHZvaWQge1xuICAgIHRoaXMuZ2xvYmFsTWVzc2FnZVNlcnZpY2UuYWRkKFxuICAgICAge1xuICAgICAgICBrZXk6ICdxdWlja09yZGVyVGFibGUuYWRkZWR0b0NhcnQnLFxuICAgICAgfSxcbiAgICAgIEdsb2JhbE1lc3NhZ2VUeXBlLk1TR19UWVBFX0NPTkZJUk1BVElPTlxuICAgICk7XG4gIH1cblxuICBwcm90ZWN0ZWQgc2V0RXJyb3JzKGVycm9yczogUXVpY2tPcmRlckFkZEVudHJ5RXZlbnRbXSk6IHZvaWQge1xuICAgIHRoaXMuY2FydEVycm9ycyQubmV4dChlcnJvcnMpO1xuICB9XG5cbiAgcHJvdGVjdGVkIHNldFdhcm5pbmdzKHdhcm5pbmdzOiBRdWlja09yZGVyQWRkRW50cnlFdmVudFtdKTogdm9pZCB7XG4gICAgdGhpcy5jYXJ0V2FybmluZ3MkLm5leHQod2FybmluZ3MpO1xuICB9XG5cbiAgcHJvdGVjdGVkIHNldFN1Y2Nlc3NlcyhlbnRyaWVzOiBPcmRlckVudHJ5W10pOiB2b2lkIHtcbiAgICB0aGlzLmNhcnRTdWNjZXNzZXMkLm5leHQoZW50cmllcyk7XG4gIH1cbn1cbiIsIjxuZy1jb250YWluZXIgKm5nSWY9XCJlbnRyaWVzJCB8IGFzeW5jIGFzIGVudHJpZXNcIj5cbiAgPG5nLWNvbnRhaW5lciAqbmdJZj1cIiEoY2FuQWRkUHJvZHVjdCgpIHwgYXN5bmMpXCI+XG4gICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cInF1aWNrT3JkZXJGb3JtPy5mb3JtPy5nZXQoJ3Byb2R1Y3QnKT8uZGlydHlcIj5cbiAgICAgIDxjeC1tZXNzYWdlXG4gICAgICAgIFt0ZXh0XT1cIlxuICAgICAgICAgICdxdWlja09yZGVyTGlzdC5lcnJvcnMubGlzdElzRnVsbCdcbiAgICAgICAgICAgIHwgY3hUcmFuc2xhdGU6IHsgY291bnQ6IGVudHJpZXMubGVuZ3RoIH1cbiAgICAgICAgXCJcbiAgICAgICAgW2lzVmlzaWJsZUNsb3NlQnV0dG9uXT1cImZhbHNlXCJcbiAgICAgICAgW3R5cGVdPVwiZ2xvYmFsTWVzc2FnZVR5cGUuTVNHX1RZUEVfRVJST1JcIlxuICAgICAgICBjbGFzcz1cInF1aWNrLW9yZGVyLWxpc3QtbGltaXQtbWVzc2FnZVwiXG4gICAgICA+XG4gICAgICA8L2N4LW1lc3NhZ2U+XG4gICAgPC9uZy1jb250YWluZXI+XG4gIDwvbmctY29udGFpbmVyPlxuPC9uZy1jb250YWluZXI+XG5cbjxuZy1jb250YWluZXIgKm5nSWY9XCJhZGRUb0NhcnRJbmZvcm1hdGlvbiQgfCBhc3luY1wiPlxuICA8Y3gtbWVzc2FnZVxuICAgIChjbG9zZU1lc3NhZ2UpPVwiY2xlYXJBZGRUb0NhcnRJbmZvcm1hdGlvbigpXCJcbiAgICBbdGV4dF09XCJcbiAgICAgICdxdWlja09yZGVyTGlzdC5pbmZvcm1hdGlvbnMuYWRkUHJvZHVjdEJlZm9yZUFkZGluZ1RvQ2FydCcgfCBjeFRyYW5zbGF0ZVxuICAgIFwiXG4gICAgW3R5cGVdPVwiZ2xvYmFsTWVzc2FnZVR5cGUuTVNHX1RZUEVfRVJST1JcIlxuICAgIGNsYXNzPVwicXVpY2stb3JkZXItYWRkLXRvLWNhcnQtaW5mb3JtYXRpb24tbWVzc2FnZVwiXG4gID5cbiAgPC9jeC1tZXNzYWdlPlxuPC9uZy1jb250YWluZXI+XG5cbjxuZy1jb250YWluZXIgKm5nSWY9XCJub25QdXJjaGFzYWJsZUVycm9yJCB8IGFzeW5jIGFzIG5vblB1cmNoYXNhYmxlRXJyb3JcIj5cbiAgPGN4LW1lc3NhZ2VcbiAgICAoY2xvc2VNZXNzYWdlKT1cImNsZWFyTm9uUHVyY2hhc2FibGVFcnJvcigpXCJcbiAgICBbdGV4dF09XCJcbiAgICAgICdxdWlja09yZGVyTGlzdC5lcnJvcnMubm9uUHVyY2hhc2FibGVFcnJvcidcbiAgICAgICAgfCBjeFRyYW5zbGF0ZTogeyBuYW1lOiBub25QdXJjaGFzYWJsZUVycm9yLm5hbWUgfVxuICAgIFwiXG4gICAgW3R5cGVdPVwiZ2xvYmFsTWVzc2FnZVR5cGUuTVNHX1RZUEVfRVJST1JcIlxuICAgIGNsYXNzPVwicXVpY2stb3JkZXItbm9uLXB1cmNoYXNhYmxlLXByb2R1Y3QtZXJyb3ItbWVzc2FnZVwiXG4gID5cbiAgPC9jeC1tZXNzYWdlPlxuPC9uZy1jb250YWluZXI+XG5cbjxuZy1jb250YWluZXIgKm5nSWY9XCJzb2Z0RGVsZXRlZEVudHJpZXMkIHwgYXN5bmMgYXMgZGVsZXRlZEVudHJpZXNcIj5cbiAgPGN4LW1lc3NhZ2VcbiAgICAqbmdGb3I9XCJsZXQgZGVsZXRlZEVudHJ5IG9mIGRlbGV0ZWRFbnRyaWVzIHwga2V5dmFsdWVcIlxuICAgIChidXR0b25BY3Rpb24pPVwidW5kb0RlbGV0aW9uKGRlbGV0ZWRFbnRyeS52YWx1ZSlcIlxuICAgIChjbG9zZU1lc3NhZ2UpPVwiY2xlYXJEZWxldGlvbihkZWxldGVkRW50cnkudmFsdWUpXCJcbiAgICBbYWN0aW9uQnV0dG9uVGV4dF09XCIncXVpY2tPcmRlckxpc3QudW5kbycgfCBjeFRyYW5zbGF0ZVwiXG4gICAgW3RleHRdPVwiXG4gICAgICAncXVpY2tPcmRlckxpc3QucHJvZHVjdFdhc0RlbGV0ZWQnXG4gICAgICAgIHwgY3hUcmFuc2xhdGU6IHsgbmFtZTogZGVsZXRlZEVudHJ5LnZhbHVlLnByb2R1Y3Q/Lm5hbWUgfVxuICAgIFwiXG4gICAgW3R5cGVdPVwiZ2xvYmFsTWVzc2FnZVR5cGUuTVNHX1RZUEVfQ09ORklSTUFUSU9OXCJcbiAgICBjbGFzcz1cInF1aWNrLW9yZGVyLWRlbGV0aW9ucy1tZXNzYWdlXCJcbiAgPlxuICA8L2N4LW1lc3NhZ2U+XG48L25nLWNvbnRhaW5lcj5cblxuPG5nLWNvbnRhaW5lciAqbmdJZj1cImVycm9ycyQgfCBhc3luYyBhcyBlcnJvcnNcIj5cbiAgPGN4LW1lc3NhZ2VcbiAgICAqbmdJZj1cImVycm9ycy5sZW5ndGhcIlxuICAgIChjbG9zZU1lc3NhZ2UpPVwiY2xlYXJFcnJvcnMoKVwiXG4gICAgW2FjY29yZGlvblRleHRdPVwiJ3F1aWNrT3JkZXJMaXN0LmVycm9ycy5yZXZpZXdFcnJvcnMnIHwgY3hUcmFuc2xhdGVcIlxuICAgIFt0ZXh0XT1cIidxdWlja09yZGVyTGlzdC5lcnJvclByb2NlZWRpbmdUb0NhcnQnIHwgY3hUcmFuc2xhdGVcIlxuICAgIFt0eXBlXT1cImdsb2JhbE1lc3NhZ2VUeXBlLk1TR19UWVBFX0VSUk9SXCJcbiAgICBjbGFzcz1cInF1aWNrLW9yZGVyLWVycm9ycy1tZXNzYWdlXCJcbiAgPlxuICAgIDx1bCBjbGFzcz1cInF1aWNrLW9yZGVyLWVycm9yc1wiPlxuICAgICAgPGxpICpuZ0Zvcj1cImxldCBlcnJvciBvZiBlcnJvcnNcIiBjbGFzcz1cInF1aWNrLW9yZGVyLWVycm9yLWl0ZW1cIj5cbiAgICAgICAgPHNwYW4+XG4gICAgICAgICAge3tcbiAgICAgICAgICAgICdxdWlja09yZGVyTGlzdC5lcnJvcnMucHJvZHVjdElzT3V0T2ZTdG9jaydcbiAgICAgICAgICAgICAgfCBjeFRyYW5zbGF0ZVxuICAgICAgICAgICAgICAgIDoge1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiBlcnJvci5lbnRyeS5wcm9kdWN0Lm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGNvZGU6IGVycm9yLmVudHJ5LnByb2R1Y3QuY29kZVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgIH19XG4gICAgICAgIDwvc3Bhbj5cbiAgICAgIDwvbGk+XG4gICAgPC91bD5cbiAgPC9jeC1tZXNzYWdlPlxuPC9uZy1jb250YWluZXI+XG5cbjxuZy1jb250YWluZXIgKm5nSWY9XCJ3YXJuaW5ncyQgfCBhc3luYyBhcyB3YXJuaW5nc1wiPlxuICA8Y3gtbWVzc2FnZVxuICAgICpuZ0lmPVwid2FybmluZ3MubGVuZ3RoXCJcbiAgICAoY2xvc2VNZXNzYWdlKT1cImNsZWFyV2FybmluZ3MoKVwiXG4gICAgW2FjY29yZGlvblRleHRdPVwiJ3F1aWNrT3JkZXJMaXN0Lndhcm5pbmdzLnJldmlld1dhcm5pbmdzJyB8IGN4VHJhbnNsYXRlXCJcbiAgICBbdGV4dF09XCIncXVpY2tPcmRlckxpc3Qud2FybmluZ1Byb2NlZWRpbmdUb0NhcnQnIHwgY3hUcmFuc2xhdGVcIlxuICAgIFt0eXBlXT1cImdsb2JhbE1lc3NhZ2VUeXBlLk1TR19UWVBFX1dBUk5JTkdcIlxuICAgIGNsYXNzPVwicXVpY2stb3JkZXItd2FybmluZ3MtbWVzc2FnZVwiXG4gID5cbiAgICA8dWwgY2xhc3M9XCJxdWljay1vcmRlci13YXJuaW5nc1wiPlxuICAgICAgPGxpICpuZ0Zvcj1cImxldCB3YXJuaW5nIG9mIHdhcm5pbmdzXCIgY2xhc3M9XCJxdWljay1vcmRlci13YXJuaW5nLWl0ZW1cIj5cbiAgICAgICAgPHNwYW4+XG4gICAgICAgICAge3tcbiAgICAgICAgICAgICdxdWlja09yZGVyTGlzdC53YXJuaW5ncy5wcm9kdWN0V2FzUmVkdWNlZCdcbiAgICAgICAgICAgICAgfCBjeFRyYW5zbGF0ZVxuICAgICAgICAgICAgICAgIDoge1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiB3YXJuaW5nLmVudHJ5LnByb2R1Y3QubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgY29kZTogd2FybmluZy5lbnRyeS5wcm9kdWN0LmNvZGUsXG4gICAgICAgICAgICAgICAgICAgIHF1YW50aXR5QWRkZWQ6IHdhcm5pbmcucXVhbnRpdHlBZGRlZFxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgIH19XG4gICAgICAgIDwvc3Bhbj5cbiAgICAgIDwvbGk+XG4gICAgPC91bD5cbiAgPC9jeC1tZXNzYWdlPlxuPC9uZy1jb250YWluZXI+XG5cbjxuZy1jb250YWluZXIgKm5nSWY9XCJzdWNjZXNzZXMkIHwgYXN5bmMgYXMgc3VjY2Vzc2VzXCI+XG4gIDxjeC1tZXNzYWdlXG4gICAgKm5nSWY9XCJzdWNjZXNzZXMubGVuZ3RoXCJcbiAgICAoY2xvc2VNZXNzYWdlKT1cImNsZWFyU3VjY2Vzc2VzKClcIlxuICAgIFt0ZXh0XT1cIidxdWlja09yZGVyTGlzdC5zdWNjZXNzZnVsbHlBZGRlZFRvQ2FydCcgfCBjeFRyYW5zbGF0ZVwiXG4gICAgW3R5cGVdPVwiZ2xvYmFsTWVzc2FnZVR5cGUuTVNHX1RZUEVfQ09ORklSTUFUSU9OXCJcbiAgICBjbGFzcz1cInF1aWNrLW9yZGVyLXN1Y2Nlc3Nlcy1tZXNzYWdlXCJcbiAgPlxuICAgIDx1bCBjbGFzcz1cInF1aWNrLW9yZGVyLXN1Y2Nlc3Nlc1wiPlxuICAgICAgPGxpICpuZ0Zvcj1cImxldCBlbnRyeSBvZiBzdWNjZXNzZXNcIiBjbGFzcz1cInF1aWNrLW9yZGVyLXN1Y2Nlc3MtaXRlbVwiPlxuICAgICAgICA8c3Bhbj57e1xuICAgICAgICAgICdxdWlja09yZGVyTGlzdC5zdWNjZXNzZXMucHJvZHVjdEFkZGVkVG9DYXJ0J1xuICAgICAgICAgICAgfCBjeFRyYW5zbGF0ZVxuICAgICAgICAgICAgICA6IHtcbiAgICAgICAgICAgICAgICAgIG5hbWU6IGVudHJ5LnByb2R1Y3QubmFtZSxcbiAgICAgICAgICAgICAgICAgIGNvZGU6IGVudHJ5LnByb2R1Y3QuY29kZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgfX08L3NwYW4+XG4gICAgICA8L2xpPlxuICAgIDwvdWw+XG4gIDwvY3gtbWVzc2FnZT5cbjwvbmctY29udGFpbmVyPlxuXG48bmctY29udGFpbmVyICpuZ0lmPVwicXVpY2tPcmRlckxpc3RMaW1pdCQgfCBhc3luYyBhcyBxdWlja09yZGVyTGlzdExpbWl0XCI+XG4gIDxuZy1jb250YWluZXIgKm5nSWY9XCJlbnRyaWVzJCB8IGFzeW5jIGFzIGVudHJpZXNcIj5cbiAgICA8ZGl2IGNsYXNzPVwicXVpY2stb3JkZXItaGVhZGVyXCI+XG4gICAgICA8aDM+e3sgJ3F1aWNrT3JkZXJMaXN0LmhlYWRlcicgfCBjeFRyYW5zbGF0ZSB9fTwvaDM+XG4gICAgICA8cD5cbiAgICAgICAge3tcbiAgICAgICAgICAncXVpY2tPcmRlckxpc3Quc3ViSGVhZGVyJ1xuICAgICAgICAgICAgfCBjeFRyYW5zbGF0ZTogeyBsaW1pdDogcXVpY2tPcmRlckxpc3RMaW1pdCB9XG4gICAgICAgIH19XG4gICAgICA8L3A+XG4gICAgPC9kaXY+XG5cbiAgICA8ZGl2IGNsYXNzPVwicXVpY2stb3JkZXItZm9ybS1ib2R5XCI+XG4gICAgICA8Y3gtcXVpY2stb3JkZXItZm9ybSAjcXVpY2tPcmRlckZvcm0+IDwvY3gtcXVpY2stb3JkZXItZm9ybT5cbiAgICA8L2Rpdj5cblxuICAgIDxkaXYgY2xhc3M9XCJxdWljay1vcmRlci10YWJsZS1ib2R5XCI+XG4gICAgICA8Y3gtcXVpY2stb3JkZXItdGFibGVcbiAgICAgICAgW2VudHJpZXNdPVwiZW50cmllc1wiXG4gICAgICAgIFtsb2FkaW5nXT1cIiEoaXNDYXJ0U3RhYmxlJCB8IGFzeW5jKVwiXG4gICAgICA+PC9jeC1xdWljay1vcmRlci10YWJsZT5cbiAgICA8L2Rpdj5cblxuICAgIDxkaXYgY2xhc3M9XCJxdWljay1vcmRlci1mb290ZXIgcm93XCI+XG4gICAgICA8ZGl2IGNsYXNzPVwiY29sLXhzLTEyIGNvbC1tZC01IGNvbC1sZy00XCI+XG4gICAgICAgIDxidXR0b25cbiAgICAgICAgICAqbmdJZj1cImVudHJpZXMubGVuZ3RoXCJcbiAgICAgICAgICAoY2xpY2spPVwiY2xlYXIoKVwiXG4gICAgICAgICAgW2F0dHIuYXJpYS1sYWJlbF09XCIncXVpY2tPcmRlckxpc3QuZW1wdHlMaXN0JyB8IGN4VHJhbnNsYXRlXCJcbiAgICAgICAgICBbZGlzYWJsZWRdPVwiIShpc0NhcnRTdGFibGUkIHwgYXN5bmMpXCJcbiAgICAgICAgICBjbGFzcz1cImJ0biBidG4tYmxvY2sgYnRuLWFjdGlvbiBjbGVhci1idXR0b25cIlxuICAgICAgICAgIHR5cGU9XCJidXR0b25cIlxuICAgICAgICA+XG4gICAgICAgICAge3sgJ3F1aWNrT3JkZXJMaXN0LmVtcHR5TGlzdCcgfCBjeFRyYW5zbGF0ZSB9fVxuICAgICAgICA8L2J1dHRvbj5cbiAgICAgIDwvZGl2PlxuXG4gICAgICA8ZGl2IGNsYXNzPVwiY29sLXhzLTEyIGNvbC1tZC01IGNvbC1sZy00XCI+XG4gICAgICAgIDxjeC1wcm9ncmVzcy1idXR0b25cbiAgICAgICAgICAoY2xpa0V2ZW50KT1cImFkZFRvQ2FydChlbnRyaWVzKVwiXG4gICAgICAgICAgW2FyaWFMYWJlbF09XCIncXVpY2tPcmRlckxpc3QuYWRkVG9DYXJ0JyB8IGN4VHJhbnNsYXRlXCJcbiAgICAgICAgICBbY2xhc3NdPVwiJ2J0bi1ibG9jayBhZGQtYnV0dG9uJ1wiXG4gICAgICAgICAgW2xvYWRpbmddPVwiIShpc0NhcnRTdGFibGUkIHwgYXN5bmMpXCJcbiAgICAgICAgPlxuICAgICAgICAgIHt7ICdxdWlja09yZGVyTGlzdC5hZGRUb0NhcnQnIHwgY3hUcmFuc2xhdGUgfX1cbiAgICAgICAgPC9jeC1wcm9ncmVzcy1idXR0b24+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgPC9uZy1jb250YWluZXI+XG48L25nLWNvbnRhaW5lcj5cbiJdfQ==