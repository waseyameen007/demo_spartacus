{"version":3,"file":"spartacus-cart-quick-order-root.umd.js","sources":["../../../feature-libs/cart/quick-order/root/config/default-quick-order.config.ts","../../../feature-libs/cart/quick-order/root/config/quick-order-config.ts","../../../feature-libs/cart/quick-order/root/feature-name.ts","../../../feature-libs/cart/quick-order/root/facade/quick-order.facade.ts","../../../feature-libs/cart/quick-order/root/pages/quick-order-order-entries-context.ts","../../../feature-libs/cart/quick-order/root/quick-order-root.module.ts","../../../feature-libs/cart/quick-order/root/spartacus-cart-quick-order-root.ts"],"sourcesContent":["import { QuickOrderConfig } from './quick-order-config';\n\nexport const defaultQuickOrderConfig: QuickOrderConfig = {\n  quickOrder: {\n    searchForm: {\n      displayProductImages: true,\n      maxProducts: 5,\n      minCharactersBeforeRequest: 3,\n    },\n  },\n};\n","import { Injectable } from '@angular/core';\nimport { Config } from '@spartacus/core';\n\n@Injectable({\n  providedIn: 'root',\n  useExisting: Config,\n})\nexport abstract class QuickOrderConfig {\n  quickOrder?: {\n    searchForm?: {\n      displayProductImages: boolean;\n      maxProducts: number;\n      minCharactersBeforeRequest: number;\n    };\n  };\n}\n\ndeclare module '@spartacus/core' {\n  interface Config extends QuickOrderConfig {}\n}\n","export const CART_QUICK_ORDER_FEATURE = 'cartQuickOrder';\nexport const CART_QUICK_ORDER_CORE_FEATURE = 'cartQuickOrderCore';\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject, Observable, Subject } from 'rxjs';\nimport { facadeFactory, OrderEntry, Product } from '@spartacus/core';\nimport { CART_QUICK_ORDER_CORE_FEATURE } from '../feature-name';\nimport { QuickOrderAddEntryEvent } from '../models/quick-order.model';\n\nexport function quickOrderFacadeFactory() {\n  return facadeFactory({\n    facade: QuickOrderFacade,\n    feature: CART_QUICK_ORDER_CORE_FEATURE,\n    methods: [\n      'addProduct',\n      'addToCart',\n      'clearList',\n      'canAdd',\n      'setListLimit',\n      'getEntries',\n      'getProductAdded',\n      'loadEntries',\n      'softDeleteEntry',\n      'search',\n      'searchProducts',\n      'setProductAdded',\n      'updateEntryQuantity',\n      'getSoftDeletedEntries',\n      'restoreSoftDeletedEntry',\n      'hardDeleteEntry',\n      'clearDeletedEntries',\n      'getNonPurchasableProductError',\n      'setNonPurchasableProductError',\n      'clearNonPurchasableProductError',\n    ],\n  });\n}\n\n@Injectable({\n  providedIn: 'root',\n  useFactory: quickOrderFacadeFactory,\n})\nexport abstract class QuickOrderFacade {\n  /**\n   * Get entries\n   */\n  abstract getEntries(): BehaviorSubject<OrderEntry[]>;\n\n  /**\n   * @deprecated since 4.2 - use searchProducts instead\n   * Search product using SKU\n   */\n  abstract search(productCode: string): Observable<Product>;\n\n  /**\n   * Search products using query\n   */\n  abstract searchProducts(\n    query: string,\n    maxProducts?: number\n  ): Observable<Product[]>;\n\n  /**\n   * Clear a list of added entries\n   */\n  abstract clearList(): void;\n\n  /**\n   * Get information about the possibility to add the next product\n   */\n  abstract canAdd(code?: string): Observable<boolean>;\n\n  /**\n   * Set quick order list limit property\n   */\n  abstract setListLimit(limit: number): void;\n\n  /**\n   * Load a list of entries\n   */\n  abstract loadEntries(entries: OrderEntry[]): void;\n\n  /**\n   * Load a list of entries\n   */\n  abstract updateEntryQuantity(entryIndex: number, quantity: number): void;\n\n  /**\n   * Delete single entry from the list\n   */\n  abstract softDeleteEntry(index: number): void;\n\n  /**\n   * @deprecated since 4.2 - use softDeleteEntry instead\n   */\n  abstract removeEntry(index: number): void;\n\n  /**\n   * Add product to the quick order list\n   */\n  abstract addProduct(product: Product, quantity?: number): void;\n\n  /**\n   * Return product added subject\n   */\n  abstract getProductAdded(): Subject<string>;\n\n  /**\n   * Set product added subject\n   */\n  abstract setProductAdded(productCode: string): void;\n\n  /**\n   * Adding to cart all products from the list\n   */\n  abstract addToCart(): Observable<[OrderEntry[], QuickOrderAddEntryEvent[]]>;\n\n  /**\n   * Return soft deleted entries\n   */\n  abstract getSoftDeletedEntries(): Observable<Record<string, OrderEntry>>;\n\n  /**\n   * Restore soft deleted entry\n   */\n  abstract restoreSoftDeletedEntry(productCode: string): void;\n\n  /**\n   * Clear deleted entry from the list\n   */\n  abstract hardDeleteEntry(productCode: string): void;\n\n  /**\n   * Clear all deleted entries and timeout subscriptions\n   */\n  abstract clearDeletedEntries(): void;\n\n  /**\n   *  Return non purchasable product error\n   */\n  abstract getNonPurchasableProductError(): Observable<Product | null>;\n\n  /**\n   * Set error that selected product is not purchasable\n   */\n  abstract setNonPurchasableProductError(product: Product): void;\n\n  /**\n   * Clear not purchasable product error\n   */\n  abstract clearNonPurchasableProductError(): void;\n}\n","import { HttpErrorResponse } from '@angular/common/http';\nimport { Injectable, isDevMode } from '@angular/core';\nimport { forkJoin, from, Observable, of, Subject } from 'rxjs';\nimport { catchError, filter, switchMap, take, tap } from 'rxjs/operators';\nimport { OrderEntry, Product, ProductConnector } from '@spartacus/core';\nimport {\n  OrderEntriesSource,\n  GetOrderEntriesContext,\n  AddOrderEntriesContext,\n  ProductData,\n  ProductImportInfo,\n  ProductImportStatus,\n} from '@spartacus/storefront';\nimport { QuickOrderFacade } from '../facade/quick-order.facade';\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class QuickOrderOrderEntriesContext\n  implements AddOrderEntriesContext, GetOrderEntriesContext\n{\n  readonly type = OrderEntriesSource.QUICK_ORDER;\n\n  constructor(\n    protected quickOrderService: QuickOrderFacade,\n    protected productConnector: ProductConnector\n  ) {}\n\n  getEntries(): Observable<OrderEntry[]> {\n    return this.quickOrderService.getEntries();\n  }\n\n  addEntries(productsData: ProductData[]): Observable<ProductImportInfo> {\n    const results$ = new Subject<ProductImportInfo>();\n\n    forkJoin(\n      productsData.map((productData) =>\n        this.productConnector.get(productData.productCode).pipe(\n          take(1),\n          catchError((response: HttpErrorResponse) => {\n            this.handleErrors(response, productData.productCode, results$);\n            return of(null);\n          })\n        )\n      )\n    )\n      .pipe(\n        switchMap((products) =>\n          from(products as Product[]).pipe(\n            filter((product) => !!product),\n            switchMap((product: Product) =>\n              this.quickOrderService.canAdd(product.code).pipe(\n                take(1),\n                tap((canAdd: boolean) => {\n                  const productData = productsData.find(\n                    (p) => p.productCode === product.code\n                  ) as ProductData;\n                  if (canAdd) {\n                    this.handleResults(product, productData, results$);\n                    this.quickOrderService.addProduct(\n                      product,\n                      productData.quantity\n                    );\n                  } else {\n                    results$.next({\n                      productCode: productData.productCode,\n                      statusCode: ProductImportStatus.LIMIT_EXCEEDED,\n                    });\n                  }\n                })\n              )\n            )\n          )\n        )\n      )\n      .subscribe();\n    return results$.pipe(take(productsData.length));\n  }\n\n  protected handleResults(\n    product: Product,\n    productData: ProductData,\n    results$: Subject<ProductImportInfo>\n  ) {\n    if (\n      product.stock?.stockLevel &&\n      productData.quantity >= product.stock.stockLevel\n    ) {\n      results$.next({\n        productCode: productData.productCode,\n        productName: product?.name,\n        statusCode: ProductImportStatus.LOW_STOCK,\n        quantity: productData.quantity,\n        quantityAdded: product.stock.stockLevel,\n      });\n    } else if (product.stock?.stockLevelStatus === 'outOfStock') {\n      results$.next({\n        productCode: productData.productCode,\n        statusCode: ProductImportStatus.NO_STOCK,\n        productName: product?.name,\n      });\n    } else {\n      results$.next({\n        productCode: productData.productCode,\n        statusCode: ProductImportStatus.SUCCESS,\n      });\n    }\n  }\n\n  protected handleErrors(\n    response: HttpErrorResponse,\n    productCode: string,\n    results$: Subject<ProductImportInfo>\n  ) {\n    if (response?.error?.errors[0].type === 'UnknownIdentifierError') {\n      results$.next({\n        productCode,\n        statusCode: ProductImportStatus.UNKNOWN_IDENTIFIER,\n      });\n    } else {\n      if (isDevMode()) {\n        console.warn(\n          'Unrecognized cart add entry action type while mapping messages',\n          response\n        );\n      }\n      results$.next({\n        productCode,\n        statusCode: ProductImportStatus.UNKNOWN_ERROR,\n      });\n    }\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { RouterModule } from '@angular/router';\nimport {\n  provideDefaultConfig,\n  provideDefaultConfigFactory,\n  RoutingConfig,\n} from '@spartacus/core';\nimport {\n  CmsPageGuard,\n  ORDER_ENTRIES_CONTEXT,\n  PageLayoutComponent,\n} from '@spartacus/storefront';\nimport { defaultQuickOrderConfig } from './config/default-quick-order.config';\nimport {\n  CART_QUICK_ORDER_CORE_FEATURE,\n  CART_QUICK_ORDER_FEATURE,\n} from './feature-name';\nimport { QuickOrderOrderEntriesContext } from './pages/quick-order-order-entries-context';\n\nexport function defaultQuickOrderComponentsConfig() {\n  const config = {\n    featureModules: {\n      [CART_QUICK_ORDER_FEATURE]: {\n        cmsComponents: ['QuickOrderComponent', 'CartQuickOrderFormComponent'],\n      },\n      // by default core is bundled together with components\n      [CART_QUICK_ORDER_CORE_FEATURE]: CART_QUICK_ORDER_FEATURE,\n    },\n  };\n  return config;\n}\n\nexport const defaultQuickOrderRoutingConfig: RoutingConfig = {\n  routing: {\n    routes: {\n      quickOrder: {\n        paths: ['my-account/quick-order'],\n      },\n    },\n  },\n};\n\n@NgModule({\n  imports: [\n    RouterModule.forChild([\n      {\n        // @ts-ignore\n        path: null,\n        canActivate: [CmsPageGuard],\n        component: PageLayoutComponent,\n        data: {\n          cxRoute: 'quickOrder',\n          cxContext: {\n            [ORDER_ENTRIES_CONTEXT]: QuickOrderOrderEntriesContext,\n          },\n        },\n      },\n    ]),\n  ],\n  providers: [\n    provideDefaultConfigFactory(defaultQuickOrderComponentsConfig),\n    provideDefaultConfig(defaultQuickOrderRoutingConfig),\n    provideDefaultConfig(defaultQuickOrderConfig),\n  ],\n})\nexport class QuickOrderRootModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":["Config","Injectable","facadeFactory","OrderEntriesSource","Subject","forkJoin","take","catchError","of","switchMap","from","filter","tap","ProductImportStatus","isDevMode","provideDefaultConfigFactory","provideDefaultConfig","RouterModule","CmsPageGuard","PageLayoutComponent","ORDER_ENTRIES_CONTEXT","NgModule"],"mappings":"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"}