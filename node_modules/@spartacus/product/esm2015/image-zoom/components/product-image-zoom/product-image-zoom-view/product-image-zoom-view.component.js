import { ChangeDetectionStrategy, Component, ElementRef, Input, ViewChild, EventEmitter, } from '@angular/core';
import { isNotNullable } from '@spartacus/core';
import { BREAKPOINT, ICON_TYPE, } from '@spartacus/storefront';
import { BehaviorSubject, combineLatest, fromEvent, merge, of, Subscription, } from 'rxjs';
import { distinctUntilChanged, filter, map, shareReplay, switchMap, switchMapTo, tap, } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "@spartacus/storefront";
import * as i2 from "../product-image-zoom-thumbnails/product-image-zoom-thumbnails.component";
import * as i3 from "@angular/common";
export class ProductImageZoomViewComponent {
    constructor(currentProductService, renderer, cdRef, breakpointService) {
        this.currentProductService = currentProductService;
        this.renderer = renderer;
        this.cdRef = cdRef;
        this.breakpointService = breakpointService;
        this.iconType = ICON_TYPE;
        this.mainMediaContainer = new BehaviorSubject(null);
        this.defaultImageReady = new BehaviorSubject(false);
        this.zoomReady = new BehaviorSubject(false);
        this.subscription = new Subscription();
        this.mainMediaContainer$ = this.mainMediaContainer.asObservable();
        this.defaultImageReady$ = this.defaultImageReady.asObservable();
        this.zoomReady$ = this.zoomReady.asObservable();
        this.activeThumb = new EventEmitter();
        this.defaultImageClickHandler$ = this.defaultImageReady$.pipe(filter(Boolean), switchMap((_) => merge(...this.clickOrDoubleClick(this.defaultImage)).pipe(tap(() => this.zoom()))));
        this.zoomImageClickHandler$ = this.zoomReady$.pipe(filter(Boolean), switchMap((_) => merge(...this.clickOrDoubleClick(this.zoomImage)).pipe(tap(() => this.zoom()))));
        this.startCoords = null;
        this.left = 0;
        this.top = 0;
        this.isZoomed = false;
        this.product$ = this.currentProductService
            .getProduct()
            .pipe(filter(isNotNullable), distinctUntilChanged(), tap((p) => {
            var _a, _b, _c, _d;
            if (this.galleryIndex) {
                const image = Array.isArray((_a = p.images) === null || _a === void 0 ? void 0 : _a.GALLERY)
                    ? (_b = p.images) === null || _b === void 0 ? void 0 : _b.GALLERY.find((img) => { var _a; return ((_a = img.zoom) === null || _a === void 0 ? void 0 : _a.galleryIndex) === this.galleryIndex; })
                    : (_c = p.images) === null || _c === void 0 ? void 0 : _c.GALLERY;
                this.mainMediaContainer.next(image || null);
            }
            else {
                this.mainMediaContainer.next(((_d = p.images) === null || _d === void 0 ? void 0 : _d.PRIMARY) ? p.images.PRIMARY : {});
            }
        }), shareReplay(1));
        this.thumbnails$ = this.product$.pipe(map((p) => this.createThumbs(p)), shareReplay(1));
        this.mainImage$ = combineLatest([
            this.product$,
            this.mainMediaContainer$,
        ]).pipe(map(([, container]) => container));
    }
    get defaultImage() {
        return this._defaultImage;
    }
    set defaultImage(el) {
        if (el) {
            this._defaultImage = el;
            this.defaultImageReady.next(true);
        }
    }
    get zoomImage() {
        return this._zoomImage;
    }
    set zoomImage(el) {
        if (el) {
            this._zoomImage = el;
            this.zoomReady.next(true);
        }
    }
    ngOnInit() {
        this.subscription.add(this.defaultImageClickHandler$.subscribe());
        this.subscription.add(this.zoomImageClickHandler$.subscribe());
    }
    openImage(item) {
        this.mainMediaContainer.next(item);
        this.activeThumb.emit(item);
    }
    /** find the index of the main media in the list of media */
    getActive() {
        var _a, _b, _c, _d;
        if (Array.isArray(this.mainMediaContainer.value)) {
            return ((_a = this.mainMediaContainer.value[0].thumbnail) === null || _a === void 0 ? void 0 : _a.galleryIndex) || 0;
        }
        return ((_d = (_c = (_b = this.mainMediaContainer) === null || _b === void 0 ? void 0 : _b.value) === null || _c === void 0 ? void 0 : _c.thumbnail) === null || _d === void 0 ? void 0 : _d.galleryIndex) || 0;
    }
    getPreviousProduct(thumbs) {
        const active = this.getActive();
        if (active === 0) {
            return thumbs[active];
        }
        return thumbs[active - 1];
    }
    getNextProduct(thumbs) {
        const active = this.getActive();
        if (active === thumbs.length - 1) {
            return thumbs[active];
        }
        return thumbs[active + 1];
    }
    /**
     * Zoom in or out of the image
     */
    zoom() {
        this.isZoomed = !this.isZoomed;
        this.startCoords = null;
        this.left = 0;
        this.top = 0;
        this.cdRef.markForCheck();
    }
    /**
     * Touch screen image pan
     *
     * @param event
     */
    touchMove(event) {
        var _a, _b, _c, _d;
        const touch = event.touches[0] || event.changedTouches[0];
        const boundingRect = (_b = (_a = this.zoomedImage) === null || _a === void 0 ? void 0 : _a.nativeElement) === null || _b === void 0 ? void 0 : _b.getBoundingClientRect();
        const imageElement = (_d = (_c = this.zoomedImage) === null || _c === void 0 ? void 0 : _c.nativeElement) === null || _d === void 0 ? void 0 : _d.firstChild;
        if (!this.startCoords)
            this.startCoords = { x: touch.clientX, y: touch.clientY };
        this.left += touch.clientX - this.startCoords.x;
        this.top += touch.clientY - this.startCoords.y;
        this.moveImage(this.left, this.top, boundingRect, imageElement);
        this.startCoords = { x: touch.clientX, y: touch.clientY };
    }
    /**
     * Clears touch location
     */
    clearTouch() {
        this.startCoords = null;
    }
    /**
     * Pointer image pan
     *
     * @param event
     */
    pointerMove(event) {
        const boundingRect = this.zoomedImage.nativeElement.getBoundingClientRect();
        const imageElement = this.zoomedImage.nativeElement.firstChild;
        const { positionX, positionY } = this.calculatePointerMovePosition(this.zoomedImage, event.clientX, event.clientY);
        this.moveImage(positionX, positionY, boundingRect, imageElement);
    }
    changeImage(event) {
        this.mainMediaContainer.next(event.image);
    }
    /**
     * Applies the offset from touchMove or pointerMove to the image element
     *
     * @param positionX
     * @param positionY
     * @param boundingRect
     * @param imageElement
     */
    moveImage(positionX, positionY, boundingRect, imageElement) {
        const { x, y } = this.handleOutOfBounds(positionX, positionY, imageElement, boundingRect);
        if (imageElement) {
            this.renderer.setStyle(imageElement, 'left', x + 'px');
            this.renderer.setStyle(imageElement, 'top', y + 'px');
        }
    }
    ngOnDestroy() {
        this.subscription.unsubscribe();
    }
    /**
     * Returns click and dblclick event mapping for the given element
     *
     * @param element
     */
    clickOrDoubleClick(element) {
        return [
            fromEvent(element.nativeElement, 'click').pipe(switchMapTo(this.breakpointService.isUp(BREAKPOINT.md)), filter(Boolean)),
            fromEvent(element.nativeElement, 'dblclick').pipe(switchMapTo(this.breakpointService.isDown(BREAKPOINT.lg)), filter(Boolean)),
        ];
    }
    /**
     * Return an array of CarouselItems for the product thumbnails.
     * In case there are less then 2 thumbs, we return null.
     */
    createThumbs(product) {
        if (!product.images ||
            !product.images.GALLERY ||
            product.images.GALLERY.length < 2) {
            return [];
        }
        const images = product.images.GALLERY;
        return images.map((c) => of({ container: c }));
    }
    /**
     * Keeps the zoom image from leaving the bounding container
     *
     * @param positionX
     * @param positionY
     * @param imageElement
     * @param boundingRect
     */
    handleOutOfBounds(positionX, positionY, imageElement, boundingRect) {
        const paddingX = 60;
        const paddingY = 60;
        if (positionY <= -(imageElement === null || imageElement === void 0 ? void 0 : imageElement.height) + paddingY) {
            positionY = -(imageElement === null || imageElement === void 0 ? void 0 : imageElement.height) + paddingY;
        }
        if (positionY >= (boundingRect === null || boundingRect === void 0 ? void 0 : boundingRect.height) - paddingY) {
            positionY = (boundingRect === null || boundingRect === void 0 ? void 0 : boundingRect.height) - paddingY;
        }
        if (positionX <=
            -(imageElement === null || imageElement === void 0 ? void 0 : imageElement.width) - (boundingRect === null || boundingRect === void 0 ? void 0 : boundingRect.width) / 2 + paddingX) {
            positionX = -(imageElement === null || imageElement === void 0 ? void 0 : imageElement.width) - (boundingRect === null || boundingRect === void 0 ? void 0 : boundingRect.width) / 2 + paddingX;
        }
        if (positionX >= (imageElement === null || imageElement === void 0 ? void 0 : imageElement.width) + (boundingRect === null || boundingRect === void 0 ? void 0 : boundingRect.width) / 2 - paddingX) {
            positionX = (imageElement === null || imageElement === void 0 ? void 0 : imageElement.width) + (boundingRect === null || boundingRect === void 0 ? void 0 : boundingRect.width) / 2 - paddingX;
        }
        return { x: positionX, y: positionY };
    }
    /**
     * Returns the position of the image based on the cursor pointer
     *
     * @param element
     * @param clientX
     * @param clientY
     */
    calculatePointerMovePosition(element, clientX, clientY) {
        const boundingRect = element.nativeElement.getBoundingClientRect();
        const x = clientX - boundingRect.left;
        const y = clientY - boundingRect.top;
        const positionX = -x + element.nativeElement.clientWidth / 2;
        const positionY = -y + element.nativeElement.clientHeight / 2;
        return { positionX, positionY };
    }
}
ProductImageZoomViewComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.0.5", ngImport: i0, type: ProductImageZoomViewComponent, deps: [{ token: i1.CurrentProductService }, { token: i0.Renderer2 }, { token: i0.ChangeDetectorRef }, { token: i1.BreakpointService }], target: i0.ɵɵFactoryTarget.Component });
ProductImageZoomViewComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.0.5", type: ProductImageZoomViewComponent, selector: "cx-product-image-zoom-view", inputs: { galleryIndex: "galleryIndex" }, viewQueries: [{ propertyName: "defaultImage", first: true, predicate: ["defaultImage"], descendants: true, read: ElementRef }, { propertyName: "zoomImage", first: true, predicate: ["zoomContainer"], descendants: true, read: ElementRef }, { propertyName: "zoomedImage", first: true, predicate: ["zoomedImage"], descendants: true, read: ElementRef }], ngImport: i0, template: "<ng-container *ngIf=\"mainImage$ | async as main\">\n  <div class=\"cx-main-image-group\" *ngIf=\"thumbnails$ | async as thumbs\">\n    <div class=\"cx-navigate-image\">\n      <button\n        class=\"btn btn-link\"\n        *ngIf=\"getPreviousProduct(thumbs) | async as previousProduct\"\n        (click)=\"openImage(previousProduct.container)\"\n      >\n        <cx-icon [type]=\"iconType.CARET_LEFT\"></cx-icon>\n      </button>\n    </div>\n    <cx-media\n      #defaultImage\n      class=\"cx-default-image-zoom\"\n      *ngIf=\"!isZoomed\"\n      [container]=\"main\"\n    >\n    </cx-media>\n    <div #zoomContainer class=\"cx-zoom-container\" *ngIf=\"isZoomed\">\n      <cx-media\n        #zoomedImage\n        class=\"cx-image-zoomed\"\n        [container]=\"main\"\n        (mousemove)=\"pointerMove($event)\"\n        (touchmove)=\"touchMove($event)\"\n        (touchend)=\"clearTouch()\"\n      >\n      </cx-media>\n    </div>\n    <div class=\"cx-navigate-image\">\n      <button\n        class=\"btn btn-link\"\n        *ngIf=\"getNextProduct(thumbs) | async as nextProduct\"\n        (click)=\"openImage(nextProduct.container)\"\n      >\n        <cx-icon [type]=\"iconType.CARET_RIGHT\"></cx-icon>\n      </button>\n    </div>\n  </div>\n</ng-container>\n\n<cx-product-image-zoom-thumbnails\n  [thumbs$]=\"thumbnails$\"\n  [activeThumb]=\"activeThumb\"\n  (productImage)=\"changeImage($event)\"\n></cx-product-image-zoom-thumbnails>\n", components: [{ type: i1.IconComponent, selector: "cx-icon,[cxIcon]", inputs: ["cxIcon", "type"] }, { type: i1.MediaComponent, selector: "cx-media", inputs: ["container", "format", "alt", "role", "loading"], outputs: ["loaded"] }, { type: i2.ProductImageZoomThumbnailsComponent, selector: "cx-product-image-zoom-thumbnails", inputs: ["thumbs$", "activeThumb"], outputs: ["productImage"] }], directives: [{ type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }], pipes: { "async": i3.AsyncPipe }, changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.0.5", ngImport: i0, type: ProductImageZoomViewComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'cx-product-image-zoom-view',
                    templateUrl: './product-image-zoom-view.component.html',
                    changeDetection: ChangeDetectionStrategy.OnPush,
                }]
        }], ctorParameters: function () { return [{ type: i1.CurrentProductService }, { type: i0.Renderer2 }, { type: i0.ChangeDetectorRef }, { type: i1.BreakpointService }]; }, propDecorators: { galleryIndex: [{
                type: Input
            }], defaultImage: [{
                type: ViewChild,
                args: ['defaultImage', { read: ElementRef }]
            }], zoomImage: [{
                type: ViewChild,
                args: ['zoomContainer', { read: ElementRef }]
            }], zoomedImage: [{
                type: ViewChild,
                args: ['zoomedImage', { read: ElementRef }]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvZHVjdC1pbWFnZS16b29tLXZpZXcuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vZmVhdHVyZS1saWJzL3Byb2R1Y3QvaW1hZ2Utem9vbS9jb21wb25lbnRzL3Byb2R1Y3QtaW1hZ2Utem9vbS9wcm9kdWN0LWltYWdlLXpvb20tdmlldy9wcm9kdWN0LWltYWdlLXpvb20tdmlldy5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi8uLi9mZWF0dXJlLWxpYnMvcHJvZHVjdC9pbWFnZS16b29tL2NvbXBvbmVudHMvcHJvZHVjdC1pbWFnZS16b29tL3Byb2R1Y3QtaW1hZ2Utem9vbS12aWV3L3Byb2R1Y3QtaW1hZ2Utem9vbS12aWV3LmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCx1QkFBdUIsRUFFdkIsU0FBUyxFQUNULFVBQVUsRUFDVixLQUFLLEVBSUwsU0FBUyxFQUNULFlBQVksR0FDYixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQWMsYUFBYSxFQUFXLE1BQU0saUJBQWlCLENBQUM7QUFFckUsT0FBTyxFQUNMLFVBQVUsRUFHVixTQUFTLEdBQ1YsTUFBTSx1QkFBdUIsQ0FBQztBQUMvQixPQUFPLEVBQ0wsZUFBZSxFQUNmLGFBQWEsRUFDYixTQUFTLEVBQ1QsS0FBSyxFQUVMLEVBQUUsRUFDRixZQUFZLEdBQ2IsTUFBTSxNQUFNLENBQUM7QUFDZCxPQUFPLEVBQ0wsb0JBQW9CLEVBQ3BCLE1BQU0sRUFDTixHQUFHLEVBQ0gsV0FBVyxFQUNYLFNBQVMsRUFDVCxXQUFXLEVBQ1gsR0FBRyxHQUNKLE1BQU0sZ0JBQWdCLENBQUM7Ozs7O0FBT3hCLE1BQU0sT0FBTyw2QkFBNkI7SUF1R3hDLFlBQ1kscUJBQTRDLEVBQzVDLFFBQW1CLEVBQ25CLEtBQXdCLEVBQ3hCLGlCQUFvQztRQUhwQywwQkFBcUIsR0FBckIscUJBQXFCLENB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QkFBQyxjQUFjLEVBQUUsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFO2dCQXNCTyxTQUFTO3NCQUE5RCxTQUFTO3VCQUFDLGVBQWUsRUFBRSxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUU7Z0JBU0EsV0FBVztzQkFBMUQsU0FBUzt1QkFBQyxhQUFhLEVBQUUsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIENoYW5nZURldGVjdG9yUmVmLFxuICBDb21wb25lbnQsXG4gIEVsZW1lbnRSZWYsXG4gIElucHV0LFxuICBPbkRlc3Ryb3ksXG4gIE9uSW5pdCxcbiAgUmVuZGVyZXIyLFxuICBWaWV3Q2hpbGQsXG4gIEV2ZW50RW1pdHRlcixcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBJbWFnZUdyb3VwLCBpc05vdE51bGxhYmxlLCBQcm9kdWN0IH0gZnJvbSAnQHNwYXJ0YWN1cy9jb3JlJztcbmltcG9ydCB7IFRodW1ibmFpbHNHcm91cCB9IGZyb20gJ0BzcGFydGFjdXMvcHJvZHVjdC9pbWFnZS16b29tL3Jvb3QnO1xuaW1wb3J0IHtcbiAgQlJFQUtQT0lOVCxcbiAgQnJlYWtwb2ludFNlcnZpY2UsXG4gIEN1cnJlbnRQcm9kdWN0U2VydmljZSxcbiAgSUNPTl9UWVBFLFxufSBmcm9tICdAc3BhcnRhY3VzL3N0b3JlZnJvbnQnO1xuaW1wb3J0IHtcbiAgQmVoYXZpb3JTdWJqZWN0LFxuICBjb21iaW5lTGF0ZXN0LFxuICBmcm9tRXZlbnQsXG4gIG1lcmdlLFxuICBPYnNlcnZhYmxlLFxuICBvZixcbiAgU3Vic2NyaXB0aW9uLFxufSBmcm9tICdyeGpzJztcbmltcG9ydCB7XG4gIGRpc3RpbmN0VW50aWxDaGFuZ2VkLFxuICBmaWx0ZXIsXG4gIG1hcCxcbiAgc2hhcmVSZXBsYXksXG4gIHN3aXRjaE1hcCxcbiAgc3dpdGNoTWFwVG8sXG4gIHRhcCxcbn0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdjeC1wcm9kdWN0LWltYWdlLXpvb20tdmlldycsXG4gIHRlbXBsYXRlVXJsOiAnLi9wcm9kdWN0LWltYWdlLXpvb20tdmlldy5jb21wb25lbnQuaHRtbCcsXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxufSlcbmV4cG9ydCBjbGFzcyBQcm9kdWN0SW1hZ2Vab29tVmlld0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcbiAgaWNvblR5cGUgPSBJQ09OX1RZUEU7XG5cbiAgQElucHV0KCkgZ2FsbGVyeUluZGV4OiBudW1iZXI7XG5cbiAgcHJpdmF0ZSBtYWluTWVkaWFDb250YWluZXIgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PEltYWdlR3JvdXAgfCBudWxsPihudWxsKTtcbiAgcHJpdmF0ZSBkZWZhdWx0SW1hZ2VSZWFkeSA9IG5ldyBCZWhhdmlvclN1YmplY3Q8Ym9vbGVhbj4oZmFsc2UpO1xuICBwcml2YXRlIHpvb21SZWFkeSA9IG5ldyBCZWhhdmlvclN1YmplY3Q8Ym9vbGVhbj4oZmFsc2UpO1xuICBwcml2YXRlIF9kZWZhdWx0SW1hZ2U6IEVsZW1lbnRSZWY7XG4gIHByaXZhdGUgX3pvb21JbWFnZTogRWxlbWVudFJlZjtcblxuICBwcm90ZWN0ZWQgc3Vic2NyaXB0aW9uID0gbmV3IFN1YnNjcmlwdGlvbigpO1xuICBwcm90ZWN0ZWQgbWFpbk1lZGlhQ29udGFpbmVyJDogT2JzZXJ2YWJsZTxJbWFnZUdyb3VwIHwgbnVsbD4gPVxuICAgIHRoaXMubWFpbk1lZGlhQ29udGFpbmVyLmFzT2JzZXJ2YWJsZSgpO1xuICBwcm90ZWN0ZWQgZGVmYXVsdEltYWdlUmVhZHkkOiBPYnNlcnZhYmxlPGJvb2xlYW4+ID1cbiAgICB0aGlzLmRlZmF1bHRJbWFnZVJlYWR5LmFzT2JzZXJ2YWJsZSgpO1xuICBwcm90ZWN0ZWQgem9vbVJlYWR5JDogT2JzZXJ2YWJsZTxib29sZWFuPiA9IHRoaXMuem9vbVJlYWR5LmFzT2JzZXJ2YWJsZSgpO1xuXG4gIGFjdGl2ZVRodW1iOiBFdmVudEVtaXR0ZXI8SW1hZ2VHcm91cD4gPSBuZXcgRXZlbnRFbWl0dGVyPEltYWdlR3JvdXA+KCk7XG5cbiAgZGVmYXVsdEltYWdlQ2xpY2tIYW5kbGVyJDogT2JzZXJ2YWJsZTxhbnlbXT4gPSB0aGlzLmRlZmF1bHRJbWFnZVJlYWR5JC5waXBlKFxuICAgIGZpbHRlcihCb29sZWFuKSxcbiAgICBzd2l0Y2hNYXAoKF8pID0+XG4gICAgICBtZXJnZSguLi50aGlzLmNsaWNrT3JEb3VibGVDbGljayh0aGlzLmRlZmF1bHRJbWFnZSkpLnBpcGUoXG4gICAgICAgIHRhcCgoKSA9PiB0aGlzLnpvb20oKSlcbiAgICAgIClcbiAgICApXG4gICk7XG5cbiAgZ2V0IGRlZmF1bHRJbWFnZSgpOiBFbGVtZW50UmVmIHtcbiAgICByZXR1cm4gdGhpcy5fZGVmYXVsdEltYWdlO1xuICB9XG5cbiAgQFZpZXdDaGlsZCgnZGVmYXVsdEltYWdlJywgeyByZWFkOiBFbGVtZW50UmVmIH0pIHNldCBkZWZhdWx0SW1hZ2UoXG4gICAgZWw6IEVsZW1lbnRSZWZcbiAgKSB7XG4gICAgaWYgKGVsKSB7XG4gICAgICB0aGlzLl9kZWZhdWx0SW1hZ2UgPSBlbDtcbiAgICAgIHRoaXMuZGVmYXVsdEltYWdlUmVhZHkubmV4dCh0cnVlKTtcbiAgICB9XG4gIH1cblxuICB6b29tSW1hZ2VDbGlja0hhbmRsZXIkOiBPYnNlcnZhYmxlPGFueVtdPiA9IHRoaXMuem9vbVJlYWR5JC5waXBlKFxuICAgIGZpbHRlcihCb29sZWFuKSxcbiAgICBzd2l0Y2hNYXAoKF8pID0+XG4gICAgICBtZXJnZSguLi50aGlzLmNsaWNrT3JEb3VibGVDbGljayh0aGlzLnpvb21JbWFnZSkpLnBpcGUoXG4gICAgICAgIHRhcCgoKSA9PiB0aGlzLnpvb20oKSlcbiAgICAgIClcbiAgICApXG4gICk7XG5cbiAgZ2V0IHpvb21JbWFnZSgpOiBFbGVtZW50UmVmIHtcbiAgICByZXR1cm4gdGhpcy5fem9vbUltYWdlO1xuICB9XG5cbiAgQFZpZXdDaGlsZCgnem9vbUNvbnRhaW5lcicsIHsgcmVhZDogRWxlbWVudFJlZiB9KSBzZXQgem9vbUltYWdlKFxuICAgIGVsOiBFbGVtZW50UmVmXG4gICkge1xuICAgIGlmIChlbCkge1xuICAgICAgdGhpcy5fem9vbUltYWdlID0gZWw7XG4gICAgICB0aGlzLnpvb21SZWFkeS5uZXh0KHRydWUpO1xuICAgIH1cbiAgfVxuXG4gIEBWaWV3Q2hpbGQoJ3pvb21lZEltYWdlJywgeyByZWFkOiBFbGVtZW50UmVmIH0pIHpvb21lZEltYWdlOiBFbGVtZW50UmVmO1xuXG4gIHN0YXJ0Q29vcmRzOiB7IHg6IG51bWJlcjsgeTogbnVtYmVyIH0gfCBudWxsID0gbnVsbDtcbiAgbGVmdCA9IDA7XG4gIHRvcCA9IDA7XG4gIGlzWm9vbWVkID0gZmFsc2U7XG5cbiAgcHJvdGVjdGVkIHByb2R1Y3QkOiBPYnNlcnZhYmxlPFByb2R1Y3Q+ID0gdGhpcy5jdXJyZW50UHJvZHVjdFNlcnZpY2VcbiAgICAuZ2V0UHJvZHVjdCgpXG4gICAgLnBpcGUoXG4gICAgICBmaWx0ZXIoaXNOb3ROdWxsYWJsZSksXG4gICAgICBkaXN0aW5jdFVudGlsQ2hhbmdlZCgpLFxuICAgICAgdGFwKChwOiBQcm9kdWN0KSA9PiB7XG4gICAgICAgIGlmICh0aGlzLmdhbGxlcnlJbmRleCkge1xuICAgICAgICAgIGNvbnN0IGltYWdlID0gQXJyYXkuaXNBcnJheShwLmltYWdlcz8uR0FMTEVSWSlcbiAgICAgICAgICAgID8gcC5pbWFnZXM/LkdBTExFUlkuZmluZChcbiAgICAgICAgICAgICAgICAoaW1nKSA9PiBpbWcuem9vbT8uZ2FsbGVyeUluZGV4ID09PSB0aGlzLmdhbGxlcnlJbmRleFxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICA6IHAuaW1hZ2VzPy5HQUxMRVJZO1xuICAgICAgICAgIHRoaXMubWFpbk1lZGlhQ29udGFpbmVyLm5leHQoaW1hZ2UgfHwgbnVsbCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5tYWluTWVkaWFDb250YWluZXIubmV4dChcbiAgICAgICAgICAgIHAuaW1hZ2VzPy5QUklNQVJZID8gKHAuaW1hZ2VzLlBSSU1BUlkgYXMgSW1hZ2VHcm91cCkgOiB7fVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0pLFxuICAgICAgc2hhcmVSZXBsYXkoMSlcbiAgICApO1xuXG4gIHRodW1ibmFpbHMkOiBPYnNlcnZhYmxlPE9ic2VydmFibGU8VGh1bWJuYWlsc0dyb3VwPltdPiA9IHRoaXMucHJvZHVjdCQucGlwZShcbiAgICBtYXAoKHA6IFByb2R1Y3QpID0+IHRoaXMuY3JlYXRlVGh1bWJzKHApKSxcbiAgICBzaGFyZVJlcGxheSgxKVxuICApO1xuXG4gIG1haW5JbWFnZSQ6IE9ic2VydmFibGU8SW1hZ2VHcm91cCB8IG51bGw+ID0gY29tYmluZUxhdGVzdChbXG4gICAgdGhpcy5wcm9kdWN0JCxcbiAgICB0aGlzLm1haW5NZWRpYUNvbnRhaW5lciQsXG4gIF0pLnBpcGUobWFwKChbLCBjb250YWluZXJdKSA9PiBjb250YWluZXIpKTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcm90ZWN0ZWQgY3VycmVudFByb2R1Y3RTZXJ2aWNlOiBDdXJyZW50UHJvZHVjdFNlcnZpY2UsXG4gICAgcHJvdGVjdGVkIHJlbmRlcmVyOiBSZW5kZXJlcjIsXG4gICAgcHJvdGVjdGVkIGNkUmVmOiBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICBwcm90ZWN0ZWQgYnJlYWtwb2ludFNlcnZpY2U6IEJyZWFrcG9pbnRTZXJ2aWNlXG4gICkge31cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLnN1YnNjcmlwdGlvbi5hZGQodGhpcy5kZWZhdWx0SW1hZ2VDbGlja0hhbmRsZXIkLnN1YnNjcmliZSgpKTtcbiAgICB0aGlzLnN1YnNjcmlwdGlvbi5hZGQodGhpcy56b29tSW1hZ2VDbGlja0hhbmRsZXIkLnN1YnNjcmliZSgpKTtcbiAgfVxuXG4gIG9wZW5JbWFnZShpdGVtOiBJbWFnZUdyb3VwKTogdm9pZCB7XG4gICAgdGhpcy5tYWluTWVkaWFDb250YWluZXIubmV4dChpdGVtKTtcbiAgICB0aGlzLmFjdGl2ZVRodW1iLmVtaXQoaXRlbSk7XG4gIH1cblxuICAvKiogZmluZCB0aGUgaW5kZXggb2YgdGhlIG1haW4gbWVkaWEgaW4gdGhlIGxpc3Qgb2YgbWVkaWEgKi9cbiAgcHJvdGVjdGVkIGdldEFjdGl2ZSgpOiBudW1iZXIge1xuICAgIGlmIChBcnJheS5pc0FycmF5KHRoaXMubWFpbk1lZGlhQ29udGFpbmVyLnZhbHVlKSkge1xuICAgICAgcmV0dXJuIHRoaXMubWFpbk1lZGlhQ29udGFpbmVyLnZhbHVlWzBdLnRodW1ibmFpbD8uZ2FsbGVyeUluZGV4IHx8IDA7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLm1haW5NZWRpYUNvbnRhaW5lcj8udmFsdWU/LnRodW1ibmFpbD8uZ2FsbGVyeUluZGV4IHx8IDA7XG4gIH1cblxuICBnZXRQcmV2aW91c1Byb2R1Y3QodGh1bWJzOiBPYnNlcnZhYmxlPEltYWdlR3JvdXA+W10pOiBPYnNlcnZhYmxlPEltYWdlR3JvdXA+IHtcbiAgICBjb25zdCBhY3RpdmUgPSB0aGlzLmdldEFjdGl2ZSgpO1xuICAgIGlmIChhY3RpdmUgPT09IDApIHtcbiAgICAgIHJldHVybiB0aHVtYnNbYWN0aXZlXTtcbiAgICB9XG4gICAgcmV0dXJuIHRodW1ic1thY3RpdmUgLSAxXTtcbiAgfVxuXG4gIGdldE5leHRQcm9kdWN0KHRodW1iczogT2JzZXJ2YWJsZTxJbWFnZUdyb3VwPltdKTogT2JzZXJ2YWJsZTxJbWFnZUdyb3VwPiB7XG4gICAgY29uc3QgYWN0aXZlID0gdGhpcy5nZXRBY3RpdmUoKTtcbiAgICBpZiAoYWN0aXZlID09PSB0aHVtYnMubGVuZ3RoIC0gMSkge1xuICAgICAgcmV0dXJuIHRodW1ic1thY3RpdmVdO1xuICAgIH1cbiAgICByZXR1cm4gdGh1bWJzW2FjdGl2ZSArIDFdO1xuICB9XG5cbiAgLyoqXG4gICAqIFpvb20gaW4gb3Igb3V0IG9mIHRoZSBpbWFnZVxuICAgKi9cbiAgem9vbSgpOiB2b2lkIHtcbiAgICB0aGlzLmlzWm9vbWVkID0gIXRoaXMuaXNab29tZWQ7XG4gICAgdGhpcy5zdGFydENvb3JkcyA9IG51bGw7XG4gICAgdGhpcy5sZWZ0ID0gMDtcbiAgICB0aGlzLnRvcCA9IDA7XG4gICAgdGhpcy5jZFJlZi5tYXJrRm9yQ2hlY2soKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUb3VjaCBzY3JlZW4gaW1hZ2UgcGFuXG4gICAqXG4gICAqIEBwYXJhbSBldmVudFxuICAgKi9cbiAgdG91Y2hNb3ZlKGV2ZW50OiBUb3VjaEV2ZW50KTogdm9pZCB7XG4gICAgY29uc3QgdG91Y2ggPSBldmVudC50b3VjaGVzWzBdIHx8IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdO1xuICAgIGNvbnN0IGJvdW5kaW5nUmVjdCA9XG4gICAgICB0aGlzLnpvb21lZEltYWdlPy5uYXRpdmVFbGVtZW50Py5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSBhcyBET01SZWN0O1xuICAgIGNvbnN0IGltYWdlRWxlbWVudCA9IHRoaXMuem9vbWVkSW1hZ2U/Lm5hdGl2ZUVsZW1lbnQ/LmZpcnN0Q2hpbGQ7XG5cbiAgICBpZiAoIXRoaXMuc3RhcnRDb29yZHMpXG4gICAgICB0aGlzLnN0YXJ0Q29vcmRzID0geyB4OiB0b3VjaC5jbGllbnRYLCB5OiB0b3VjaC5jbGllbnRZIH07XG5cbiAgICB0aGlzLmxlZnQgKz0gdG91Y2guY2xpZW50WCAtIHRoaXMuc3RhcnRDb29yZHMueDtcbiAgICB0aGlzLnRvcCArPSB0b3VjaC5jbGllbnRZIC0gdGhpcy5zdGFydENvb3Jkcy55O1xuXG4gICAgdGhpcy5tb3ZlSW1hZ2UodGhpcy5sZWZ0LCB0aGlzLnRvcCwgYm91bmRpbmdSZWN0LCBpbWFnZUVsZW1lbnQpO1xuXG4gICAgdGhpcy5zdGFydENvb3JkcyA9IHsgeDogdG91Y2guY2xpZW50WCwgeTogdG91Y2guY2xpZW50WSB9O1xuICB9XG5cbiAgLyoqXG4gICAqIENsZWFycyB0b3VjaCBsb2NhdGlvblxuICAgKi9cbiAgY2xlYXJUb3VjaCgpOiB2b2lkIHtcbiAgICB0aGlzLnN0YXJ0Q29vcmRzID0gbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBQb2ludGVyIGltYWdlIHBhblxuICAgKlxuICAgKiBAcGFyYW0gZXZlbnRcbiAgICovXG4gIHBvaW50ZXJNb3ZlKGV2ZW50OiBNb3VzZUV2ZW50KTogdm9pZCB7XG4gICAgY29uc3QgYm91bmRpbmdSZWN0ID1cbiAgICAgIHRoaXMuem9vbWVkSW1hZ2UubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSBhcyBET01SZWN0O1xuICAgIGNvbnN0IGltYWdlRWxlbWVudCA9IHRoaXMuem9vbWVkSW1hZ2UubmF0aXZlRWxlbWVudC5maXJzdENoaWxkO1xuXG4gICAgY29uc3QgeyBwb3NpdGlvblgsIHBvc2l0aW9uWSB9ID0gdGhpcy5jYWxjdWxhdGVQb2ludGVyTW92ZVBvc2l0aW9uKFxuICAgICAgdGhpcy56b29tZWRJbWFnZSxcbiAgICAgIGV2ZW50LmNsaWVudFgsXG4gICAgICBldmVudC5jbGllbnRZXG4gICAgKTtcblxuICAgIHRoaXMubW92ZUltYWdlKHBvc2l0aW9uWCwgcG9zaXRpb25ZLCBib3VuZGluZ1JlY3QsIGltYWdlRWxlbWVudCk7XG4gIH1cblxuICBjaGFuZ2VJbWFnZShldmVudDogeyBpbWFnZTogSW1hZ2VHcm91cDsgaW5kZXg6IG51bWJlciB9KTogdm9pZCB7XG4gICAgdGhpcy5tYWluTWVkaWFDb250YWluZXIubmV4dChldmVudC5pbWFnZSk7XG4gIH1cblxuICAvKipcbiAgICogQXBwbGllcyB0aGUgb2Zmc2V0IGZyb20gdG91Y2hNb3ZlIG9yIHBvaW50ZXJNb3ZlIHRvIHRoZSBpbWFnZSBlbGVtZW50XG4gICAqXG4gICAqIEBwYXJhbSBwb3NpdGlvblhcbiAgICogQHBhcmFtIHBvc2l0aW9uWVxuICAgKiBAcGFyYW0gYm91bmRpbmdSZWN0XG4gICAqIEBwYXJhbSBpbWFnZUVsZW1lbnRcbiAgICovXG4gIHByb3RlY3RlZCBtb3ZlSW1hZ2UoXG4gICAgcG9zaXRpb25YOiBudW1iZXIsXG4gICAgcG9zaXRpb25ZOiBudW1iZXIsXG4gICAgYm91bmRpbmdSZWN0OiBhbnksXG4gICAgaW1hZ2VFbGVtZW50OiBET01SZWN0XG4gICk6IHZvaWQge1xuICAgIGNvbnN0IHsgeCwgeSB9ID0gdGhpcy5oYW5kbGVPdXRPZkJvdW5kcyhcbiAgICAgIHBvc2l0aW9uWCxcbiAgICAgIHBvc2l0aW9uWSxcbiAgICAgIGltYWdlRWxlbWVudCxcbiAgICAgIGJvdW5kaW5nUmVjdFxuICAgICk7XG5cbiAgICBpZiAoaW1hZ2VFbGVtZW50KSB7XG4gICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKGltYWdlRWxlbWVudCwgJ2xlZnQnLCB4ICsgJ3B4Jyk7XG4gICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKGltYWdlRWxlbWVudCwgJ3RvcCcsIHkgKyAncHgnKTtcbiAgICB9XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLnN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgY2xpY2sgYW5kIGRibGNsaWNrIGV2ZW50IG1hcHBpbmcgZm9yIHRoZSBnaXZlbiBlbGVtZW50XG4gICAqXG4gICAqIEBwYXJhbSBlbGVtZW50XG4gICAqL1xuICBwcml2YXRlIGNsaWNrT3JEb3VibGVDbGljayhlbGVtZW50OiBFbGVtZW50UmVmKTogT2JzZXJ2YWJsZTxhbnk+W10ge1xuICAgIHJldHVybiBbXG4gICAgICBmcm9tRXZlbnQoZWxlbWVudC5uYXRpdmVFbGVtZW50LCAnY2xpY2snKS5waXBlKFxuICAgICAgICBzd2l0Y2hNYXBUbyh0aGlzLmJyZWFrcG9pbnRTZXJ2aWNlLmlzVXAoQlJFQUtQT0lOVC5tZCkpLFxuICAgICAgICBmaWx0ZXIoQm9vbGVhbilcbiAgICAgICksXG4gICAgICBmcm9tRXZlbnQoZWxlbWVudC5uYXRpdmVFbGVtZW50LCAnZGJsY2xpY2snKS5waXBlKFxuICAgICAgICBzd2l0Y2hNYXBUbyh0aGlzLmJyZWFrcG9pbnRTZXJ2aWNlLmlzRG93bihCUkVBS1BPSU5ULmxnKSksXG4gICAgICAgIGZpbHRlcihCb29sZWFuKVxuICAgICAgKSxcbiAgICBdO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybiBhbiBhcnJheSBvZiBDYXJvdXNlbEl0ZW1zIGZvciB0aGUgcHJvZHVjdCB0aHVtYm5haWxzLlxuICAgKiBJbiBjYXNlIHRoZXJlIGFyZSBsZXNzIHRoZW4gMiB0aHVtYnMsIHdlIHJldHVybiBudWxsLlxuICAgKi9cbiAgcHJpdmF0ZSBjcmVhdGVUaHVtYnMocHJvZHVjdDogUHJvZHVjdCk6IE9ic2VydmFibGU8VGh1bWJuYWlsc0dyb3VwPltdIHtcbiAgICBpZiAoXG4gICAgICAhcHJvZHVjdC5pbWFnZXMgfHxcbiAgICAgICFwcm9kdWN0LmltYWdlcy5HQUxMRVJZIHx8XG4gICAgICBwcm9kdWN0LmltYWdlcy5HQUxMRVJZLmxlbmd0aCA8IDJcbiAgICApIHtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG5cbiAgICBjb25zdCBpbWFnZXM6IEltYWdlR3JvdXBbXSA9IHByb2R1Y3QuaW1hZ2VzLkdBTExFUlkgYXMgSW1hZ2VHcm91cFtdO1xuXG4gICAgcmV0dXJuIGltYWdlcy5tYXAoKGMpID0+IG9mKHsgY29udGFpbmVyOiBjIH0pKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBLZWVwcyB0aGUgem9vbSBpbWFnZSBmcm9tIGxlYXZpbmcgdGhlIGJvdW5kaW5nIGNvbnRhaW5lclxuICAgKlxuICAgKiBAcGFyYW0gcG9zaXRpb25YXG4gICAqIEBwYXJhbSBwb3NpdGlvbllcbiAgICogQHBhcmFtIGltYWdlRWxlbWVudFxuICAgKiBAcGFyYW0gYm91bmRpbmdSZWN0XG4gICAqL1xuICBoYW5kbGVPdXRPZkJvdW5kcyhcbiAgICBwb3NpdGlvblg6IG51bWJlcixcbiAgICBwb3NpdGlvblk6IG51bWJlcixcbiAgICBpbWFnZUVsZW1lbnQ6IGFueSxcbiAgICBib3VuZGluZ1JlY3Q6IERPTVJlY3RcbiAgKTogeyB4OiBudW1iZXI7IHk6IG51bWJlciB9IHtcbiAgICBjb25zdCBwYWRkaW5nWCA9IDYwO1xuICAgIGNvbnN0IHBhZGRpbmdZID0gNjA7XG5cbiAgICBpZiAocG9zaXRpb25ZIDw9IC1pbWFnZUVsZW1lbnQ/LmhlaWdodCArIHBhZGRpbmdZKSB7XG4gICAgICBwb3NpdGlvblkgPSAtaW1hZ2VFbGVtZW50Py5oZWlnaHQgKyBwYWRkaW5nWTtcbiAgICB9XG4gICAgaWYgKHBvc2l0aW9uWSA+PSBib3VuZGluZ1JlY3Q/LmhlaWdodCAtIHBhZGRpbmdZKSB7XG4gICAgICBwb3NpdGlvblkgPSBib3VuZGluZ1JlY3Q/LmhlaWdodCAtIHBhZGRpbmdZO1xuICAgIH1cbiAgICBpZiAoXG4gICAgICBwb3NpdGlvblggPD1cbiAgICAgIC1pbWFnZUVsZW1lbnQ/LndpZHRoIC0gYm91bmRpbmdSZWN0Py53aWR0aCAvIDIgKyBwYWRkaW5nWFxuICAgICkge1xuICAgICAgcG9zaXRpb25YID0gLWltYWdlRWxlbWVudD8ud2lkdGggLSBib3VuZGluZ1JlY3Q/LndpZHRoIC8gMiArIHBhZGRpbmdYO1xuICAgIH1cbiAgICBpZiAocG9zaXRpb25YID49IGltYWdlRWxlbWVudD8ud2lkdGggKyBib3VuZGluZ1JlY3Q/LndpZHRoIC8gMiAtIHBhZGRpbmdYKSB7XG4gICAgICBwb3NpdGlvblggPSBpbWFnZUVsZW1lbnQ/LndpZHRoICsgYm91bmRpbmdSZWN0Py53aWR0aCAvIDIgLSBwYWRkaW5nWDtcbiAgICB9XG5cbiAgICByZXR1cm4geyB4OiBwb3NpdGlvblgsIHk6IHBvc2l0aW9uWSB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIHBvc2l0aW9uIG9mIHRoZSBpbWFnZSBiYXNlZCBvbiB0aGUgY3Vyc29yIHBvaW50ZXJcbiAgICpcbiAgICogQHBhcmFtIGVsZW1lbnRcbiAgICogQHBhcmFtIGNsaWVudFhcbiAgICogQHBhcmFtIGNsaWVudFlcbiAgICovXG4gIGNhbGN1bGF0ZVBvaW50ZXJNb3ZlUG9zaXRpb24oXG4gICAgZWxlbWVudDogRWxlbWVudFJlZixcbiAgICBjbGllbnRYOiBudW1iZXIsXG4gICAgY2xpZW50WTogbnVtYmVyXG4gICk6IHsgcG9zaXRpb25YOiBudW1iZXI7IHBvc2l0aW9uWTogbnVtYmVyIH0ge1xuICAgIGNvbnN0IGJvdW5kaW5nUmVjdCA9XG4gICAgICBlbGVtZW50Lm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkgYXMgRE9NUmVjdDtcblxuICAgIGNvbnN0IHggPSBjbGllbnRYIC0gYm91bmRpbmdSZWN0LmxlZnQ7XG4gICAgY29uc3QgeSA9IGNsaWVudFkgLSBib3VuZGluZ1JlY3QudG9wO1xuXG4gICAgY29uc3QgcG9zaXRpb25YID0gLXggKyBlbGVtZW50Lm5hdGl2ZUVsZW1lbnQuY2xpZW50V2lkdGggLyAyO1xuICAgIGNvbnN0IHBvc2l0aW9uWSA9IC15ICsgZWxlbWVudC5uYXRpdmVFbGVtZW50LmNsaWVudEhlaWdodCAvIDI7XG5cbiAgICByZXR1cm4geyBwb3NpdGlvblgsIHBvc2l0aW9uWSB9O1xuICB9XG59XG4iLCI8bmctY29udGFpbmVyICpuZ0lmPVwibWFpbkltYWdlJCB8IGFzeW5jIGFzIG1haW5cIj5cbiAgPGRpdiBjbGFzcz1cImN4LW1haW4taW1hZ2UtZ3JvdXBcIiAqbmdJZj1cInRodW1ibmFpbHMkIHwgYXN5bmMgYXMgdGh1bWJzXCI+XG4gICAgPGRpdiBjbGFzcz1cImN4LW5hdmlnYXRlLWltYWdlXCI+XG4gICAgICA8YnV0dG9uXG4gICAgICAgIGNsYXNzPVwiYnRuIGJ0bi1saW5rXCJcbiAgICAgICAgKm5nSWY9XCJnZXRQcmV2aW91c1Byb2R1Y3QodGh1bWJzKSB8IGFzeW5jIGFzIHByZXZpb3VzUHJvZHVjdFwiXG4gICAgICAgIChjbGljayk9XCJvcGVuSW1hZ2UocHJldmlvdXNQcm9kdWN0LmNvbnRhaW5lcilcIlxuICAgICAgPlxuICAgICAgICA8Y3gtaWNvbiBbdHlwZV09XCJpY29uVHlwZS5DQVJFVF9MRUZUXCI+PC9jeC1pY29uPlxuICAgICAgPC9idXR0b24+XG4gICAgPC9kaXY+XG4gICAgPGN4LW1lZGlhXG4gICAgICAjZGVmYXVsdEltYWdlXG4gICAgICBjbGFzcz1cImN4LWRlZmF1bHQtaW1hZ2Utem9vbVwiXG4gICAgICAqbmdJZj1cIiFpc1pvb21lZFwiXG4gICAgICBbY29udGFpbmVyXT1cIm1haW5cIlxuICAgID5cbiAgICA8L2N4LW1lZGlhPlxuICAgIDxkaXYgI3pvb21Db250YWluZXIgY2xhc3M9XCJjeC16b29tLWNvbnRhaW5lclwiICpuZ0lmPVwiaXNab29tZWRcIj5cbiAgICAgIDxjeC1tZWRpYVxuICAgICAgICAjem9vbWVkSW1hZ2VcbiAgICAgICAgY2xhc3M9XCJjeC1pbWFnZS16b29tZWRcIlxuICAgICAgICBbY29udGFpbmVyXT1cIm1haW5cIlxuICAgICAgICAobW91c2Vtb3ZlKT1cInBvaW50ZXJNb3ZlKCRldmVudClcIlxuICAgICAgICAodG91Y2htb3ZlKT1cInRvdWNoTW92ZSgkZXZlbnQpXCJcbiAgICAgICAgKHRvdWNoZW5kKT1cImNsZWFyVG91Y2goKVwiXG4gICAgICA+XG4gICAgICA8L2N4LW1lZGlhPlxuICAgIDwvZGl2PlxuICAgIDxkaXYgY2xhc3M9XCJjeC1uYXZpZ2F0ZS1pbWFnZVwiPlxuICAgICAgPGJ1dHRvblxuICAgICAgICBjbGFzcz1cImJ0biBidG4tbGlua1wiXG4gICAgICAgICpuZ0lmPVwiZ2V0TmV4dFByb2R1Y3QodGh1bWJzKSB8IGFzeW5jIGFzIG5leHRQcm9kdWN0XCJcbiAgICAgICAgKGNsaWNrKT1cIm9wZW5JbWFnZShuZXh0UHJvZHVjdC5jb250YWluZXIpXCJcbiAgICAgID5cbiAgICAgICAgPGN4LWljb24gW3R5cGVdPVwiaWNvblR5cGUuQ0FSRVRfUklHSFRcIj48L2N4LWljb24+XG4gICAgICA8L2J1dHRvbj5cbiAgICA8L2Rpdj5cbiAgPC9kaXY+XG48L25nLWNvbnRhaW5lcj5cblxuPGN4LXByb2R1Y3QtaW1hZ2Utem9vbS10aHVtYm5haWxzXG4gIFt0aHVtYnMkXT1cInRodW1ibmFpbHMkXCJcbiAgW2FjdGl2ZVRodW1iXT1cImFjdGl2ZVRodW1iXCJcbiAgKHByb2R1Y3RJbWFnZSk9XCJjaGFuZ2VJbWFnZSgkZXZlbnQpXCJcbj48L2N4LXByb2R1Y3QtaW1hZ2Utem9vbS10aHVtYm5haWxzPlxuIl19