{"version":3,"file":"spartacus-product-bulk-pricing-core.umd.js","sources":["../../../feature-libs/product/bulk-pricing/core/services/bulk-pricing.service.ts","../../../feature-libs/product/bulk-pricing/core/spartacus-product-bulk-pricing-core.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { Price, Product, ProductService, ProductScope } from '@spartacus/core';\nimport { Observable, of } from 'rxjs';\nimport { switchMap } from 'rxjs/operators';\nimport { BulkPrice } from '../model/bulk-price.model';\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class BulkPricingService {\n  protected readonly PRODUCT_SCOPE = ProductScope.BULK_PRICES;\n\n  constructor(protected productService: ProductService) {}\n\n  getBulkPrices(productCode: string): Observable<BulkPrice[] | undefined> {\n    return this.productService.get(productCode, this.PRODUCT_SCOPE).pipe(\n      switchMap((productPriceScope) => {\n        return of(this.convert(productPriceScope));\n      })\n    );\n  }\n\n  protected convert(productPriceScope: Product): BulkPrice[] | undefined {\n    let bulkPrices: BulkPrice[] | undefined = [];\n\n    if (productPriceScope) {\n      const basePrice: number | undefined = productPriceScope.price?.value;\n      const volumePrices: Price[] | undefined = productPriceScope.volumePrices;\n\n      bulkPrices = volumePrices?.map((volumePrice) =>\n        this.parsePrice(volumePrice, basePrice)\n      );\n    }\n\n    return bulkPrices;\n  }\n\n  protected parsePrice(\n    priceTier: Price,\n    basePrice: number | undefined\n  ): BulkPrice {\n    const bulkPriceTemplate: BulkPrice = {\n      currencyIso: priceTier.currencyIso,\n      formattedValue: priceTier.formattedValue,\n      maxQuantity: priceTier.maxQuantity,\n      minQuantity: priceTier.minQuantity,\n      priceType: priceTier.priceType,\n      value: priceTier.value,\n      formattedDiscount: '',\n      discount: 0,\n    };\n\n    return this.calculateDiscount(bulkPriceTemplate, basePrice);\n  }\n\n  protected calculateDiscount(\n    bulkPriceTemplate: BulkPrice,\n    basePrice: number | undefined\n  ): BulkPrice {\n    const bulkPrice = Object.assign({}, bulkPriceTemplate);\n\n    const tierPrice: number | undefined = bulkPriceTemplate.value;\n\n    if (tierPrice && basePrice) {\n      const discount = Math.round(100.0 - (tierPrice / basePrice) * 100);\n      const formatted = discount === 0 ? `${discount}%` : `-${discount}%`;\n      bulkPrice.formattedDiscount = formatted;\n      bulkPrice.discount = discount;\n    }\n\n    return bulkPrice;\n  }\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":["switchMap","of","Injectable"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;QAYE,4BAAsB,cAA8B;YAA9B,mBAAc,GAAd,cAAc,CAAgB;YAFjC,kBAAa,kCAA4B;SAEJ;QAExD,0CAAa,GAAb,UAAc,WAAmB;YAAjC,iBAMC;YALC,OAAO,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,WAAW,EAAE,IAAI,CAAC,aAAa,CAAC,CAAC,IAAI,CAClEA,mBAAS,CAAC,UAAC,iBAAiB;gBAC1B,OAAOC,OAAE,CAAC,KAAI,CAAC,OAAO,CAAC,iBAAiB,CAAC,CAAC,CAAC;aAC5C,CAAC,CACH,CAAC;SACH;QAES,oCAAO,GAAP,UAAQ,iBAA0B;YAAlC,iBAaT;;YAZC,IAAI,UAAU,GAA4B,EAAE,CAAC;YAE7C,IAAI,iBAAiB,EAAE;gBACrB,IAAM,WAAS,GAAuB,MAAA,iBAAiB,CAAC,KAAK,0CAAE,KAAK,CAAC;gBACrE,IAAM,YAAY,GAAwB,iBAAiB,CAAC,YAAY,CAAC;gBAEzE,UAAU,GAAG,YAAY,aAAZ,YAAY,uBAAZ,YAAY,CAAE,GAAG,CAAC,UAAC,WAAW,IACzC,OAAA,KAAI,CAAC,UAAU,CAAC,WAAW,EAAE,WAAS,CAAC,GAAA,CACxC,CAAC;aACH;YAED,OAAO,UAAU,CAAC;SACnB;QAES,uCAAU,GAAV,UACR,SAAgB,EAChB,SAA6B;YAE7B,IAAM,iBAAiB,GAAc;gBACnC,WAAW,EAAE,SAAS,CAAC,WAAW;gBAClC,cAAc,EAAE,SAAS,CAAC,cAAc;gBACxC,WAAW,EAAE,SAAS,CAAC,WAAW;gBAClC,WAAW,EAAE,SAAS,CAAC,WAAW;gBAClC,SAAS,EAAE,SAAS,CAAC,SAAS;gBAC9B,KAAK,EAAE,SAAS,CAAC,KAAK;gBACtB,iBAAiB,EAAE,EAAE;gBACrB,QAAQ,EAAE,CAAC;aACZ,CAAC;YAEF,OAAO,IAAI,CAAC,iBAAiB,CAAC,iBAAiB,EAAE,SAAS,CAAC,CAAC;SAC7D;QAES,8CAAiB,GAAjB,UACR,iBAA4B,EAC5B,SAA6B;YAE7B,IAAM,SAAS,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,iBAAiB,CAAC,CAAC;YAEvD,IAAM,SAAS,GAAuB,iBAAiB,CAAC,KAAK,CAAC;YAE9D,IAAI,SAAS,IAAI,SAAS,EAAE;gBAC1B,IAAM,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,GAAG,CAAC,SAAS,GAAG,SAAS,IAAI,GAAG,CAAC,CAAC;gBACnE,IAAM,SAAS,GAAG,QAAQ,KAAK,CAAC,GAAM,QAAQ,MAAG,GAAG,MAAI,QAAQ,MAAG,CAAC;gBACpE,SAAS,CAAC,iBAAiB,GAAG,SAAS,CAAC;gBACxC,SAAS,CAAC,QAAQ,GAAG,QAAQ,CAAC;aAC/B;YAED,OAAO,SAAS,CAAC;SAClB;;;yIA9DU,kBAAkB;6IAAlB,kBAAkB,cAFjB,MAAM;qHAEP,kBAAkB;sBAH9BC,aAAU;uBAAC;wBACV,UAAU,EAAE,MAAM;qBACnB;;;ICRD;;;;;;;;;;;;"}