{"version":3,"file":"spartacus-product-bulk-pricing-core.js","sources":["../../../feature-libs/product/bulk-pricing/core/services/bulk-pricing.service.ts","../../../feature-libs/product/bulk-pricing/core/spartacus-product-bulk-pricing-core.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { Price, Product, ProductService, ProductScope } from '@spartacus/core';\nimport { Observable, of } from 'rxjs';\nimport { switchMap } from 'rxjs/operators';\nimport { BulkPrice } from '../model/bulk-price.model';\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class BulkPricingService {\n  protected readonly PRODUCT_SCOPE = ProductScope.BULK_PRICES;\n\n  constructor(protected productService: ProductService) {}\n\n  getBulkPrices(productCode: string): Observable<BulkPrice[] | undefined> {\n    return this.productService.get(productCode, this.PRODUCT_SCOPE).pipe(\n      switchMap((productPriceScope) => {\n        return of(this.convert(productPriceScope));\n      })\n    );\n  }\n\n  protected convert(productPriceScope: Product): BulkPrice[] | undefined {\n    let bulkPrices: BulkPrice[] | undefined = [];\n\n    if (productPriceScope) {\n      const basePrice: number | undefined = productPriceScope.price?.value;\n      const volumePrices: Price[] | undefined = productPriceScope.volumePrices;\n\n      bulkPrices = volumePrices?.map((volumePrice) =>\n        this.parsePrice(volumePrice, basePrice)\n      );\n    }\n\n    return bulkPrices;\n  }\n\n  protected parsePrice(\n    priceTier: Price,\n    basePrice: number | undefined\n  ): BulkPrice {\n    const bulkPriceTemplate: BulkPrice = {\n      currencyIso: priceTier.currencyIso,\n      formattedValue: priceTier.formattedValue,\n      maxQuantity: priceTier.maxQuantity,\n      minQuantity: priceTier.minQuantity,\n      priceType: priceTier.priceType,\n      value: priceTier.value,\n      formattedDiscount: '',\n      discount: 0,\n    };\n\n    return this.calculateDiscount(bulkPriceTemplate, basePrice);\n  }\n\n  protected calculateDiscount(\n    bulkPriceTemplate: BulkPrice,\n    basePrice: number | undefined\n  ): BulkPrice {\n    const bulkPrice = Object.assign({}, bulkPriceTemplate);\n\n    const tierPrice: number | undefined = bulkPriceTemplate.value;\n\n    if (tierPrice && basePrice) {\n      const discount = Math.round(100.0 - (tierPrice / basePrice) * 100);\n      const formatted = discount === 0 ? `${discount}%` : `-${discount}%`;\n      bulkPrice.formattedDiscount = formatted;\n      bulkPrice.discount = discount;\n    }\n\n    return bulkPrice;\n  }\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":[],"mappings":";;;;;;MASa,kBAAkB;IAG7B,YAAsB,cAA8B;QAA9B,mBAAc,GAAd,cAAc,CAAgB;QAFjC,kBAAa,kCAA4B;KAEJ;IAExD,aAAa,CAAC,WAAmB;QAC/B,OAAO,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,WAAW,EAAE,IAAI,CAAC,aAAa,CAAC,CAAC,IAAI,CAClE,SAAS,CAAC,CAAC,iBAAiB;YAC1B,OAAO,EAAE,CAAC,IAAI,CAAC,OAAO,CAAC,iBAAiB,CAAC,CAAC,CAAC;SAC5C,CAAC,CACH,CAAC;KACH;IAES,OAAO,CAAC,iBAA0B;;QAC1C,IAAI,UAAU,GAA4B,EAAE,CAAC;QAE7C,IAAI,iBAAiB,EAAE;YACrB,MAAM,SAAS,GAAuB,MAAA,iBAAiB,CAAC,KAAK,0CAAE,KAAK,CAAC;YACrE,MAAM,YAAY,GAAwB,iBAAiB,CAAC,YAAY,CAAC;YAEzE,UAAU,GAAG,YAAY,aAAZ,YAAY,uBAAZ,YAAY,CAAE,GAAG,CAAC,CAAC,WAAW,KACzC,IAAI,CAAC,UAAU,CAAC,WAAW,EAAE,SAAS,CAAC,CACxC,CAAC;SACH;QAED,OAAO,UAAU,CAAC;KACnB;IAES,UAAU,CAClB,SAAgB,EAChB,SAA6B;QAE7B,MAAM,iBAAiB,GAAc;YACnC,WAAW,EAAE,SAAS,CAAC,WAAW;YAClC,cAAc,EAAE,SAAS,CAAC,cAAc;YACxC,WAAW,EAAE,SAAS,CAAC,WAAW;YAClC,WAAW,EAAE,SAAS,CAAC,WAAW;YAClC,SAAS,EAAE,SAAS,CAAC,SAAS;YAC9B,KAAK,EAAE,SAAS,CAAC,KAAK;YACtB,iBAAiB,EAAE,EAAE;YACrB,QAAQ,EAAE,CAAC;SACZ,CAAC;QAEF,OAAO,IAAI,CAAC,iBAAiB,CAAC,iBAAiB,EAAE,SAAS,CAAC,CAAC;KAC7D;IAES,iBAAiB,CACzB,iBAA4B,EAC5B,SAA6B;QAE7B,MAAM,SAAS,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,iBAAiB,CAAC,CAAC;QAEvD,MAAM,SAAS,GAAuB,iBAAiB,CAAC,KAAK,CAAC;QAE9D,IAAI,SAAS,IAAI,SAAS,EAAE;YAC1B,MAAM,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,GAAG,CAAC,SAAS,GAAG,SAAS,IAAI,GAAG,CAAC,CAAC;YACnE,MAAM,SAAS,GAAG,QAAQ,KAAK,CAAC,GAAG,GAAG,QAAQ,GAAG,GAAG,IAAI,QAAQ,GAAG,CAAC;YACpE,SAAS,CAAC,iBAAiB,GAAG,SAAS,CAAC;YACxC,SAAS,CAAC,QAAQ,GAAG,QAAQ,CAAC;SAC/B;QAED,OAAO,SAAS,CAAC;KAClB;;+GA9DU,kBAAkB;mHAAlB,kBAAkB,cAFjB,MAAM;2FAEP,kBAAkB;kBAH9B,UAAU;mBAAC;oBACV,UAAU,EAAE,MAAM;iBACnB;;;ACRD;;;;;;"}