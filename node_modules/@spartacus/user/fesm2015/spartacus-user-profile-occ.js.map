{"version":3,"file":"spartacus-user-profile-occ.js","sources":["../../../feature-libs/user/profile/occ/adapters/config/default-occ-user-profile-endpoint.config.ts","../../../feature-libs/user/profile/occ/adapters/occ-user-profile.adapter.ts","../../../feature-libs/user/profile/occ/user-profile-occ.module.ts","../../../feature-libs/user/profile/occ/spartacus-user-profile-occ.ts"],"sourcesContent":["import { OccConfig } from '@spartacus/core';\n\nexport const defaultOccUserProfileConfig: OccConfig = {\n  backend: {\n    occ: {\n      endpoints: {\n        userRegister: 'users',\n        userForgotPassword: 'forgottenpasswordtokens',\n        userResetPassword: 'resetpassword',\n        userUpdateLoginId: 'users/${userId}/login',\n        userUpdatePassword: 'users/${userId}/password',\n        titles: 'titles',\n      },\n    },\n  },\n};\n","import { HttpClient, HttpHeaders, HttpParams } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\nimport {\n  ConverterService,\n  InterceptorUtil,\n  normalizeHttpError,\n  Occ,\n  OccEndpointsService,\n  USE_CLIENT_TOKEN,\n} from '@spartacus/core';\nimport { User } from '@spartacus/user/account/root';\nimport {\n  TITLE_NORMALIZER,\n  UserProfileAdapter,\n  USER_PROFILE_NORMALIZER,\n  USER_PROFILE_SERIALIZER,\n  USER_SIGN_UP_SERIALIZER,\n} from '@spartacus/user/profile/core';\nimport { Title, UserSignUp } from '@spartacus/user/profile/root';\nimport { Observable, throwError } from 'rxjs';\nimport { catchError, map } from 'rxjs/operators';\n\n@Injectable()\nexport class OccUserProfileAdapter implements UserProfileAdapter {\n  constructor(\n    protected http: HttpClient,\n    protected occEndpoints: OccEndpointsService,\n    protected converter: ConverterService\n  ) {}\n\n  update(userId: string, user: User): Observable<unknown> {\n    const endpoint = this.occEndpoints.isConfigured('userUpdateProfile')\n      ? 'userUpdateProfile'\n      : 'user';\n    const url = this.occEndpoints.buildUrl(endpoint, { urlParams: { userId } });\n    user = this.converter.convert(user, USER_PROFILE_SERIALIZER);\n    return this.http\n      .patch(url, user)\n      .pipe(catchError((error) => throwError(normalizeHttpError(error))));\n  }\n\n  register(user: UserSignUp): Observable<User> {\n    const url: string = this.occEndpoints.buildUrl('userRegister');\n    let headers = new HttpHeaders({\n      'Content-Type': 'application/json',\n    });\n    headers = InterceptorUtil.createHeader(USE_CLIENT_TOKEN, true, headers);\n    user = this.converter.convert(user, USER_SIGN_UP_SERIALIZER);\n\n    return this.http.post<User>(url, user, { headers }).pipe(\n      catchError((error) => throwError(normalizeHttpError(error))),\n      this.converter.pipeable(USER_PROFILE_NORMALIZER)\n    );\n  }\n\n  registerGuest(guid: string, password: string): Observable<User> {\n    const url: string = this.occEndpoints.buildUrl('userRegister');\n    let headers = new HttpHeaders({\n      'Content-Type': 'application/x-www-form-urlencoded',\n    });\n    headers = InterceptorUtil.createHeader(USE_CLIENT_TOKEN, true, headers);\n\n    const httpParams: HttpParams = new HttpParams()\n      .set('guid', guid)\n      .set('password', password);\n\n    return this.http.post<User>(url, httpParams, { headers }).pipe(\n      catchError((error) => throwError(normalizeHttpError(error))),\n      this.converter.pipeable(USER_PROFILE_NORMALIZER)\n    );\n  }\n\n  requestForgotPasswordEmail(userEmailAddress: string): Observable<unknown> {\n    const url = this.occEndpoints.buildUrl('userForgotPassword');\n    const httpParams: HttpParams = new HttpParams().set(\n      'userId',\n      userEmailAddress\n    );\n    let headers = new HttpHeaders({\n      'Content-Type': 'application/x-www-form-urlencoded',\n    });\n    headers = InterceptorUtil.createHeader(USE_CLIENT_TOKEN, true, headers);\n    return this.http\n      .post(url, httpParams, { headers })\n      .pipe(catchError((error) => throwError(normalizeHttpError(error))));\n  }\n\n  resetPassword(token: string, newPassword: string): Observable<unknown> {\n    const url = this.occEndpoints.buildUrl('userResetPassword');\n    let headers = new HttpHeaders({\n      'Content-Type': 'application/json',\n    });\n    headers = InterceptorUtil.createHeader(USE_CLIENT_TOKEN, true, headers);\n\n    return this.http\n      .post(url, { token, newPassword }, { headers })\n      .pipe(catchError((error) => throwError(normalizeHttpError(error))));\n  }\n\n  updateEmail(\n    userId: string,\n    currentPassword: string,\n    newUserId: string\n  ): Observable<unknown> {\n    const url = this.occEndpoints.buildUrl('userUpdateLoginId', {\n      urlParams: { userId },\n    });\n    const httpParams: HttpParams = new HttpParams()\n      .set('password', currentPassword)\n      .set('newLogin', newUserId);\n    const headers = new HttpHeaders({\n      'Content-Type': 'application/x-www-form-urlencoded',\n    });\n    return this.http\n      .put(url, httpParams, { headers })\n      .pipe(catchError((error) => throwError(normalizeHttpError(error))));\n  }\n\n  updatePassword(\n    userId: string,\n    oldPassword: string,\n    newPassword: string\n  ): Observable<unknown> {\n    const url = this.occEndpoints.buildUrl('userUpdatePassword', {\n      urlParams: { userId },\n    });\n    const httpParams: HttpParams = new HttpParams()\n      .set('old', oldPassword)\n      .set('new', newPassword);\n    const headers = new HttpHeaders({\n      'Content-Type': 'application/x-www-form-urlencoded',\n    });\n    return this.http\n      .put(url, httpParams, { headers })\n      .pipe(catchError((error) => throwError(normalizeHttpError(error))));\n  }\n\n  close(userId: string): Observable<unknown> {\n    const endpoint = this.occEndpoints.isConfigured('userCloseAccount')\n      ? 'userCloseAccount'\n      : 'user';\n    const url = this.occEndpoints.buildUrl(endpoint, { urlParams: { userId } });\n    return this.http\n      .delete<User>(url)\n      .pipe(catchError((error) => throwError(normalizeHttpError(error))));\n  }\n\n  loadTitles(): Observable<Title[]> {\n    const url = this.occEndpoints.buildUrl('titles');\n    return this.http.get<Occ.TitleList>(url).pipe(\n      catchError((error) => throwError(normalizeHttpError(error))),\n      map((titleList) => titleList.titles ?? []),\n      this.converter.pipeableMany(TITLE_NORMALIZER)\n    );\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { provideDefaultConfig } from '@spartacus/core';\nimport { UserProfileAdapter } from '@spartacus/user/profile/core';\nimport { defaultOccUserProfileConfig } from './adapters/config/default-occ-user-profile-endpoint.config';\nimport { OccUserProfileAdapter } from './adapters/occ-user-profile.adapter';\n\n@NgModule({\n  providers: [\n    provideDefaultConfig(defaultOccUserProfileConfig),\n    { provide: UserProfileAdapter, useClass: OccUserProfileAdapter },\n  ],\n})\nexport class UserProfileOccModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":[],"mappings":"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"}