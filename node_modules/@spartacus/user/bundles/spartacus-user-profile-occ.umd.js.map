{"version":3,"file":"spartacus-user-profile-occ.umd.js","sources":["../../../feature-libs/user/profile/occ/adapters/config/default-occ-user-profile-endpoint.config.ts","../../../feature-libs/user/profile/occ/adapters/occ-user-profile.adapter.ts","../../../feature-libs/user/profile/occ/user-profile-occ.module.ts","../../../feature-libs/user/profile/occ/spartacus-user-profile-occ.ts"],"sourcesContent":["import { OccConfig } from '@spartacus/core';\n\nexport const defaultOccUserProfileConfig: OccConfig = {\n  backend: {\n    occ: {\n      endpoints: {\n        userRegister: 'users',\n        userForgotPassword: 'forgottenpasswordtokens',\n        userResetPassword: 'resetpassword',\n        userUpdateLoginId: 'users/${userId}/login',\n        userUpdatePassword: 'users/${userId}/password',\n        titles: 'titles',\n      },\n    },\n  },\n};\n","import { HttpClient, HttpHeaders, HttpParams } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\nimport {\n  ConverterService,\n  InterceptorUtil,\n  normalizeHttpError,\n  Occ,\n  OccEndpointsService,\n  USE_CLIENT_TOKEN,\n} from '@spartacus/core';\nimport { User } from '@spartacus/user/account/root';\nimport {\n  TITLE_NORMALIZER,\n  UserProfileAdapter,\n  USER_PROFILE_NORMALIZER,\n  USER_PROFILE_SERIALIZER,\n  USER_SIGN_UP_SERIALIZER,\n} from '@spartacus/user/profile/core';\nimport { Title, UserSignUp } from '@spartacus/user/profile/root';\nimport { Observable, throwError } from 'rxjs';\nimport { catchError, map } from 'rxjs/operators';\n\n@Injectable()\nexport class OccUserProfileAdapter implements UserProfileAdapter {\n  constructor(\n    protected http: HttpClient,\n    protected occEndpoints: OccEndpointsService,\n    protected converter: ConverterService\n  ) {}\n\n  update(userId: string, user: User): Observable<unknown> {\n    const endpoint = this.occEndpoints.isConfigured('userUpdateProfile')\n      ? 'userUpdateProfile'\n      : 'user';\n    const url = this.occEndpoints.buildUrl(endpoint, { urlParams: { userId } });\n    user = this.converter.convert(user, USER_PROFILE_SERIALIZER);\n    return this.http\n      .patch(url, user)\n      .pipe(catchError((error) => throwError(normalizeHttpError(error))));\n  }\n\n  register(user: UserSignUp): Observable<User> {\n    const url: string = this.occEndpoints.buildUrl('userRegister');\n    let headers = new HttpHeaders({\n      'Content-Type': 'application/json',\n    });\n    headers = InterceptorUtil.createHeader(USE_CLIENT_TOKEN, true, headers);\n    user = this.converter.convert(user, USER_SIGN_UP_SERIALIZER);\n\n    return this.http.post<User>(url, user, { headers }).pipe(\n      catchError((error) => throwError(normalizeHttpError(error))),\n      this.converter.pipeable(USER_PROFILE_NORMALIZER)\n    );\n  }\n\n  registerGuest(guid: string, password: string): Observable<User> {\n    const url: string = this.occEndpoints.buildUrl('userRegister');\n    let headers = new HttpHeaders({\n      'Content-Type': 'application/x-www-form-urlencoded',\n    });\n    headers = InterceptorUtil.createHeader(USE_CLIENT_TOKEN, true, headers);\n\n    const httpParams: HttpParams = new HttpParams()\n      .set('guid', guid)\n      .set('password', password);\n\n    return this.http.post<User>(url, httpParams, { headers }).pipe(\n      catchError((error) => throwError(normalizeHttpError(error))),\n      this.converter.pipeable(USER_PROFILE_NORMALIZER)\n    );\n  }\n\n  requestForgotPasswordEmail(userEmailAddress: string): Observable<unknown> {\n    const url = this.occEndpoints.buildUrl('userForgotPassword');\n    const httpParams: HttpParams = new HttpParams().set(\n      'userId',\n      userEmailAddress\n    );\n    let headers = new HttpHeaders({\n      'Content-Type': 'application/x-www-form-urlencoded',\n    });\n    headers = InterceptorUtil.createHeader(USE_CLIENT_TOKEN, true, headers);\n    return this.http\n      .post(url, httpParams, { headers })\n      .pipe(catchError((error) => throwError(normalizeHttpError(error))));\n  }\n\n  resetPassword(token: string, newPassword: string): Observable<unknown> {\n    const url = this.occEndpoints.buildUrl('userResetPassword');\n    let headers = new HttpHeaders({\n      'Content-Type': 'application/json',\n    });\n    headers = InterceptorUtil.createHeader(USE_CLIENT_TOKEN, true, headers);\n\n    return this.http\n      .post(url, { token, newPassword }, { headers })\n      .pipe(catchError((error) => throwError(normalizeHttpError(error))));\n  }\n\n  updateEmail(\n    userId: string,\n    currentPassword: string,\n    newUserId: string\n  ): Observable<unknown> {\n    const url = this.occEndpoints.buildUrl('userUpdateLoginId', {\n      urlParams: { userId },\n    });\n    const httpParams: HttpParams = new HttpParams()\n      .set('password', currentPassword)\n      .set('newLogin', newUserId);\n    const headers = new HttpHeaders({\n      'Content-Type': 'application/x-www-form-urlencoded',\n    });\n    return this.http\n      .put(url, httpParams, { headers })\n      .pipe(catchError((error) => throwError(normalizeHttpError(error))));\n  }\n\n  updatePassword(\n    userId: string,\n    oldPassword: string,\n    newPassword: string\n  ): Observable<unknown> {\n    const url = this.occEndpoints.buildUrl('userUpdatePassword', {\n      urlParams: { userId },\n    });\n    const httpParams: HttpParams = new HttpParams()\n      .set('old', oldPassword)\n      .set('new', newPassword);\n    const headers = new HttpHeaders({\n      'Content-Type': 'application/x-www-form-urlencoded',\n    });\n    return this.http\n      .put(url, httpParams, { headers })\n      .pipe(catchError((error) => throwError(normalizeHttpError(error))));\n  }\n\n  close(userId: string): Observable<unknown> {\n    const endpoint = this.occEndpoints.isConfigured('userCloseAccount')\n      ? 'userCloseAccount'\n      : 'user';\n    const url = this.occEndpoints.buildUrl(endpoint, { urlParams: { userId } });\n    return this.http\n      .delete<User>(url)\n      .pipe(catchError((error) => throwError(normalizeHttpError(error))));\n  }\n\n  loadTitles(): Observable<Title[]> {\n    const url = this.occEndpoints.buildUrl('titles');\n    return this.http.get<Occ.TitleList>(url).pipe(\n      catchError((error) => throwError(normalizeHttpError(error))),\n      map((titleList) => titleList.titles ?? []),\n      this.converter.pipeableMany(TITLE_NORMALIZER)\n    );\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { provideDefaultConfig } from '@spartacus/core';\nimport { UserProfileAdapter } from '@spartacus/user/profile/core';\nimport { defaultOccUserProfileConfig } from './adapters/config/default-occ-user-profile-endpoint.config';\nimport { OccUserProfileAdapter } from './adapters/occ-user-profile.adapter';\n\n@NgModule({\n  providers: [\n    provideDefaultConfig(defaultOccUserProfileConfig),\n    { provide: UserProfileAdapter, useClass: OccUserProfileAdapter },\n  ],\n})\nexport class UserProfileOccModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":["USER_PROFILE_SERIALIZER","catchError","throwError","normalizeHttpError","HttpHeaders","InterceptorUtil","USE_CLIENT_TOKEN","USER_SIGN_UP_SERIALIZER","USER_PROFILE_NORMALIZER","HttpParams","map","TITLE_NORMALIZER","Injectable","provideDefaultConfig","UserProfileAdapter","NgModule"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;QAEa,2BAA2B,GAAc;QACpD,OAAO,EAAE;YACP,GAAG,EAAE;gBACH,SAAS,EAAE;oBACT,YAAY,EAAE,OAAO;oBACrB,kBAAkB,EAAE,yBAAyB;oBAC7C,iBAAiB,EAAE,eAAe;oBAClC,iBAAiB,EAAE,uBAAuB;oBAC1C,kBAAkB,EAAE,0BAA0B;oBAC9C,MAAM,EAAE,QAAQ;iBACjB;aACF;SACF;;;;QCUD,+BACY,IAAgB,EAChB,YAAiC,EACjC,SAA2B;YAF3B,SAAI,GAAJ,IAAI,CAAY;YAChB,iBAAY,GAAZ,YAAY,CAAqB;YACjC,cAAS,GAAT,SAAS,CAAkB;SACnC;QAEJ,sCAAM,GAAN,UAAO,MAAc,EAAE,IAAU;YAC/B,IAAM,QAAQ,GAAG,IAAI,CAAC,YAAY,CAAC,YAAY,CAAC,mBAAmB,CAAC;kBAChE,mBAAmB;kBACnB,MAAM,CAAC;YACX,IAAM,GAAG,GAAG,IAAI,CAAC,YAAY,CAAC,QAAQ,CAAC,QAAQ,EAAE,EAAE,SAAS,EAAE,EAAE,MAAM,QAAA,EAAE,EAAE,CAAC,CAAC;YAC5E,IAAI,GAAG,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,IAAI,EAAEA,4BAAuB,CAAC,CAAC;YAC7D,OAAO,IAAI,CAAC,IAAI;iBACb,KAAK,CAAC,GAAG,EAAE,IAAI,CAAC;iBAChB,IAAI,CAACC,oBAAU,CAAC,UAAC,KAAK,IAAK,OAAAC,eAAU,CAACC,qBAAkB,CAAC,KAAK,CAAC,CAAC,GAAA,CAAC,CAAC,CAAC;SACvE;QAED,wCAAQ,GAAR,UAAS,IAAgB;YACvB,IAAM,GAAG,GAAW,IAAI,CAAC,YAAY,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC;YAC/D,IAAI,OAAO,GAAG,IAAIC,cAAW,CAAC;gBAC5B,cAAc,EAAE,kBAAkB;aACnC,CAAC,CAAC;YACH,OAAO,GAAGC,kBAAe,CAAC,YAAY,CAACC,mBAAgB,EAAE,IAAI,EAAE,OAAO,CAAC,CAAC;YACxE,IAAI,GAAG,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,IAAI,EAAEC,4BAAuB,CAAC,CAAC;YAE7D,OAAO,IAAI,CAAC,IAAI,CAAC,IAAI,CAAO,GAAG,EAAE,IAAI,EAAE,EAAE,OAAO,SAAA,EAAE,CAAC,CAAC,IAAI,CACtDN,oBAAU,CAAC,UAAC,KAAK,IAAK,OAAAC,eAAU,CAACC,qBAAkB,CAAC,KAAK,CAAC,CAAC,GAAA,CAAC,EAC5D,IAAI,CAAC,SAAS,CAAC,QAAQ,CAACK,4BAAuB,CAAC,CACjD,CAAC;SACH;QAED,6CAAa,GAAb,UAAc,IAAY,EAAE,QAAgB;YAC1C,IAAM,GAAG,GAAW,IAAI,CAAC,YAAY,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC;YAC/D,IAAI,OAAO,GAAG,IAAIJ,cAAW,CAAC;gBAC5B,cAAc,EAAE,mCAAmC;aACpD,CAAC,CAAC;YACH,OAAO,GAAGC,kBAAe,CAAC,YAAY,CAACC,mBAAgB,EAAE,IAAI,EAAE,OAAO,CAAC,CAAC;YAExE,IAAM,UAAU,GAAe,IAAIG,aAAU,EAAE;iBAC5C,GAAG,CAAC,MAAM,EAAE,IAAI,CAAC;iBACjB,GAAG,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC;YAE7B,OAAO,IAAI,CAAC,IAAI,CAAC,IAAI,CAAO,GAAG,EAAE,UAAU,EAAE,EAAE,OAAO,SAAA,EAAE,CAAC,CAAC,IAAI,CAC5DR,oBAAU,CAAC,UAAC,KAAK,IAAK,OAAAC,eAAU,CAACC,qBAAkB,CAAC,KAAK,CAAC,CAAC,GAAA,CAAC,EAC5D,IAAI,CAAC,SAAS,CAAC,QAAQ,CAACK,4BAAuB,CAAC,CACjD,CAAC;SACH;QAED,0DAA0B,GAA1B,UAA2B,gBAAwB;YACjD,IAAM,GAAG,GAAG,IAAI,CAAC,YAAY,CAAC,QAAQ,CAAC,oBAAoB,CAAC,CAAC;YAC7D,IAAM,UAAU,GAAe,IAAIC,aAAU,EAAE,CAAC,GAAG,CACjD,QAAQ,EACR,gBAAgB,CACjB,CAAC;YACF,IAAI,OAAO,GAAG,IAAIL,cAAW,CAAC;gBAC5B,cAAc,EAAE,mCAAmC;aACpD,CAAC,CAAC;YACH,OAAO,GAAGC,kBAAe,CAAC,YAAY,CAACC,mBAAgB,EAAE,IAAI,EAAE,OAAO,CAAC,CAAC;YACxE,OAAO,IAAI,CAAC,IAAI;iBACb,IAAI,CAAC,GAAG,EAAE,UAAU,EAAE,EAAE,OAAO,SAAA,EAAE,CAAC;iBAClC,IAAI,CAACL,oBAAU,CAAC,UAAC,KAAK,IAAK,OAAAC,eAAU,CAACC,qBAAkB,CAAC,KAAK,CAAC,CAAC,GAAA,CAAC,CAAC,CAAC;SACvE;QAED,6CAAa,GAAb,UAAc,KAAa,EAAE,WAAmB;YAC9C,IAAM,GAAG,GAAG,IAAI,CAAC,YAAY,CAAC,QAAQ,CAAC,mBAAmB,CAAC,CAAC;YAC5D,IAAI,OAAO,GAAG,IAAIC,cAAW,CAAC;gBAC5B,cAAc,EAAE,kBAAkB;aACnC,CAAC,CAAC;YACH,OAAO,GAAGC,kBAAe,CAAC,YAAY,CAACC,mBAAgB,EAAE,IAAI,EAAE,OAAO,CAAC,CAAC;YAExE,OAAO,IAAI,CAAC,IAAI;iBACb,IAAI,CAAC,GAAG,EAAE,EAAE,KAAK,OAAA,EAAE,WAAW,aAAA,EAAE,EAAE,EAAE,OAAO,SAAA,EAAE,CAAC;iBAC9C,IAAI,CAACL,oBAAU,CAAC,UAAC,KAAK,IAAK,OAAAC,eAAU,CAACC,qBAAkB,CAAC,KAAK,CAAC,CAAC,GAAA,CAAC,CAAC,CAAC;SACvE;QAED,2CAAW,GAAX,UACE,MAAc,EACd,eAAuB,EACvB,SAAiB;YAEjB,IAAM,GAAG,GAAG,IAAI,CAAC,YAAY,CAAC,QAAQ,CAAC,mBAAmB,EAAE;gBAC1D,SAAS,EAAE,EAAE,MAAM,QAAA,EAAE;aACtB,CAAC,CAAC;YACH,IAAM,UAAU,GAAe,IAAIM,aAAU,EAAE;iBAC5C,GAAG,CAAC,UAAU,EAAE,eAAe,CAAC;iBAChC,GAAG,CAAC,UAAU,EAAE,SAAS,CAAC,CAAC;YAC9B,IAAM,OAAO,GAAG,IAAIL,cAAW,CAAC;gBAC9B,cAAc,EAAE,mCAAmC;aACpD,CAAC,CAAC;YACH,OAAO,IAAI,CAAC,IAAI;iBACb,GAAG,CAAC,GAAG,EAAE,UAAU,EAAE,EAAE,OAAO,SAAA,EAAE,CAAC;iBACjC,IAAI,CAACH,oBAAU,CAAC,UAAC,KAAK,IAAK,OAAAC,eAAU,CAACC,qBAAkB,CAAC,KAAK,CAAC,CAAC,GAAA,CAAC,CAAC,CAAC;SACvE;QAED,8CAAc,GAAd,UACE,MAAc,EACd,WAAmB,EACnB,WAAmB;YAEnB,IAAM,GAAG,GAAG,IAAI,CAAC,YAAY,CAAC,QAAQ,CAAC,oBAAoB,EAAE;gBAC3D,SAAS,EAAE,EAAE,MAAM,QAAA,EAAE;aACtB,CAAC,CAAC;YACH,IAAM,UAAU,GAAe,IAAIM,aAAU,EAAE;iBAC5C,GAAG,CAAC,KAAK,EAAE,WAAW,CAAC;iBACvB,GAAG,CAAC,KAAK,EAAE,WAAW,CAAC,CAAC;YAC3B,IAAM,OAAO,GAAG,IAAIL,cAAW,CAAC;gBAC9B,cAAc,EAAE,mCAAmC;aACpD,CAAC,CAAC;YACH,OAAO,IAAI,CAAC,IAAI;iBACb,GAAG,CAAC,GAAG,EAAE,UAAU,EAAE,EAAE,OAAO,SAAA,EAAE,CAAC;iBACjC,IAAI,CAACH,oBAAU,CAAC,UAAC,KAAK,IAAK,OAAAC,eAAU,CAACC,qBAAkB,CAAC,KAAK,CAAC,CAAC,GAAA,CAAC,CAAC,CAAC;SACvE;QAED,qCAAK,GAAL,UAAM,MAAc;YAClB,IAAM,QAAQ,GAAG,IAAI,CAAC,YAAY,CAAC,YAAY,CAAC,kBAAkB,CAAC;kBAC/D,kBAAkB;kBAClB,MAAM,CAAC;YACX,IAAM,GAAG,GAAG,IAAI,CAAC,YAAY,CAAC,QAAQ,CAAC,QAAQ,EAAE,EAAE,SAAS,EAAE,EAAE,MAAM,QAAA,EAAE,EAAE,CAAC,CAAC;YAC5E,OAAO,IAAI,CAAC,IAAI;iBACb,MAAM,CAAO,GAAG,CAAC;iBACjB,IAAI,CAACF,oBAAU,CAAC,UAAC,KAAK,IAAK,OAAAC,eAAU,CAACC,qBAAkB,CAAC,KAAK,CAAC,CAAC,GAAA,CAAC,CAAC,CAAC;SACvE;QAED,0CAAU,GAAV;YACE,IAAM,GAAG,GAAG,IAAI,CAAC,YAAY,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;YACjD,OAAO,IAAI,CAAC,IAAI,CAAC,GAAG,CAAgB,GAAG,CAAC,CAAC,IAAI,CAC3CF,oBAAU,CAAC,UAAC,KAAK,IAAK,OAAAC,eAAU,CAACC,qBAAkB,CAAC,KAAK,CAAC,CAAC,GAAA,CAAC,EAC5DO,aAAG,CAAC,UAAC,SAAS,YAAK,OAAA,MAAA,SAAS,CAAC,MAAM,mCAAI,EAAE,CAAA,EAAA,CAAC,EAC1C,IAAI,CAAC,SAAS,CAAC,YAAY,CAACC,qBAAgB,CAAC,CAC9C,CAAC;SACH;;;4IAnIU,qBAAqB;gJAArB,qBAAqB;qHAArB,qBAAqB;sBADjCC,aAAU;;;;QCVX;;;;2IAAa,oBAAoB;4IAApB,oBAAoB;4IAApB,oBAAoB,aALpB;YACTC,uBAAoB,CAAC,2BAA2B,CAAC;YACjD,EAAE,OAAO,EAAEC,uBAAkB,EAAE,QAAQ,EAAE,qBAAqB,EAAE;SACjE;qHAEU,oBAAoB;sBANhCC,WAAQ;uBAAC;wBACR,SAAS,EAAE;4BACTF,uBAAoB,CAAC,2BAA2B,CAAC;4BACjD,EAAE,OAAO,EAAEC,uBAAkB,EAAE,QAAQ,EAAE,qBAAqB,EAAE;yBACjE;qBACF;;;ICXD;;;;;;;;;;;;;;"}